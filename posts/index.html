<!doctype html><html lang=en><head><meta charset=utf-8><title>Posts &ndash; The Leo Zone</title><link rel=icon href=/img/favicon.png type=image/x-icon><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://theleo.zone/sass/main.min.2d43c4d15d5c6744c808f0eddbc12aed7cc95aebe01212d38e8064687a81bfed.css></head><body><header><div class=container><div class=nav-container><div class=nav-left><a class=btn-text href=/><h1>Leo</h1></a></div><div class=dropdown><input class="hamburger menu-btn" type=checkbox id=menu-btn>
<label class="hamburger menu-icon" for=menu-btn><span class=navicon-top></span>
<span class=navicon-mid></span>
<span class=navicon-bottom></span></label><div class=menu><a class=menu-item href=/>Home</a>
<a class=menu-item href=/about>About</a>
<a class=menu-item href=https://github.com/robinovitch61 target=_blank><img class=social-media-thumbnail src=/img/github.png alt=github title=github></a></div></div></div></div></header><div class=top-title><div class=container><h2>Posts</h2></div></div><div class=post-date><div class=container><p></p></div></div><div class=container><h1>DEFAULT LIST</h1><article><h2>setting up tidal cycles</h2><p><a href=https://tidalcycles.org/>Tidal Cycles</a> is software that works on top of another piece of software called
<a href=https://supercollider.github.io/>SuperCollider</a>.</p><p>Together, you can use them to produce music using code.</p><p>Today I set up these tools and made my first sound with them. Setup was a bit tricky, and this post is as much for
myself to document what I did as it is for others pursuing their own setup in the future.</p><p>The first step is to install SuperCollider, following the install links for your platform
at <a href=https://supercollider.github.io/>supercollider.github.io</a>.</p><p>SuperCollider is a super cool tool in and of itself, featuring a fully formed object-oriented language with which to
generate, template, pattern and mix sounds.</p><p>Tidal Cycles features a completely different language, though: a domain-specific language in Haskell. In order to set up
Tidal Cycles, you don&rsquo;t need to learn any of the native SuperCollider language or do any of the tutorials offered on
startup.</p><p>Once SuperCollider is installed, Tidal Cycles requires installation of some other dependencies. They offer good setup
instructions for each platform <a href=https://tidalcycles.org/docs/getting-started/macos_install>here</a>
(link leads to MacOS instructions, but other platforms are in the sidebar).</p><p>These dependencies include:</p><ul><li>SuperCollider: already installed above</li><li>SuperDirt: a SuperCollider sampler designed for Tidal Cycles</li><li>Atom Editor with Tidal Cycles plugin: optional (I uninstall it and don&rsquo;t use it in the final setup, but good for
testing)</li><li>Haskell</li><li>The <code>tidal</code> Haskell package</li></ul><p>A good explanation for how these components
interact (<a href=https://tidalcycles.org/docs/getting-started/tidal_start>source</a>):</p><a class=img-link target=_blank href=/img/tidal.jpg><figure><img style=max-width:90% src=/img/tidal.jpg alt=tidal.jpg></figure></a><p>To test things are working:</p><ol><li><p>Open SuperCollider.</p></li><li><p>Paste in the left editor box <code>SuperDirt.start;</code>.</p></li><li><p>Run it by hitting Shift-Enter with your cursor on the same line. You should see output in the bottom right like:</p></li></ol><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>SuperDirt: listening to Tidal on port <span style=color:#666>57120</span></span></span></code></pre></div><ol start=4><li><p>Keeping SuperCollider and SuperDirt open and running, open Atom. Confirm Tidal Cycles plugin is installed (visible on
the bottom right).</p></li><li><p>Create a new file called <code>test.tidal</code></p></li><li><p>Add the line <code>d1 $ sound "bd sd"</code></p></li><li><p>Type ctrl-Enter or cmd-Enter with your cursor on the same line. A beat should play!</p></li></ol><p>Now this is the stock setup working. I changed mine a bit for convenience, but if you&rsquo;d like to you can stop here
and proceed with actually using the software to make music :).</p><p>After this confirmation things were installed and working, I uninstalled Atom, as it&rsquo;s not an editor I use regularly.
I&rsquo;m a fan of <code>vim</code>.</p><p>I then went to SuperCollider and configured it to start up SuperDirt whenever it is first opened. I did this by clicking
<code>File -> Open startup file</code>, pasting in the following text, and saving the startup file:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>/*
</span></span><span style=display:flex><span>This is an example startup file. You can load it from your startup file
</span></span><span style=display:flex><span><span style=color:#666>(</span>to be found in Platform.userAppSupportDir +/+ <span style=color:#ba2121>&#34;startup.scd&#34;</span><span style=color:#666>)</span>
</span></span><span style=display:flex><span>*/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#666>(</span>
</span></span><span style=display:flex><span>s.reboot <span style=color:#666>{</span> // server options are only updated on reboot
</span></span><span style=display:flex><span>    // configure the sound server: here you could add hardware specific options
</span></span><span style=display:flex><span>    // see http://doc.sccode.org/Classes/ServerOptions.html
</span></span><span style=display:flex><span>    s.options.numBuffers <span style=color:#666>=</span> <span style=color:#666>1024</span> * 256; // increase this <span style=color:green;font-weight:700>if</span> you need to load more samples
</span></span><span style=display:flex><span>    s.options.memSize <span style=color:#666>=</span> <span style=color:#666>8192</span> * 32; // increase this <span style=color:green;font-weight:700>if</span> you get <span style=color:#ba2121>&#34;alloc failed&#34;</span> messages
</span></span><span style=display:flex><span>    s.options.numWireBufs <span style=color:#666>=</span> 64; // increase this <span style=color:green;font-weight:700>if</span> you get <span style=color:#ba2121>&#34;exceeded number of interconnect buffers&#34;</span> messages 
</span></span><span style=display:flex><span>    s.options.maxNodes <span style=color:#666>=</span> <span style=color:#666>1024</span> * 32; // increase this <span style=color:green;font-weight:700>if</span> you are getting drop outs and the message <span style=color:#ba2121>&#34;too many nodes&#34;</span>
</span></span><span style=display:flex><span>    s.options.numOutputBusChannels <span style=color:#666>=</span> 2; // <span style=color:green>set</span> this to your hardware output channel size, <span style=color:green;font-weight:700>if</span> necessary
</span></span><span style=display:flex><span>    s.options.numInputBusChannels <span style=color:#666>=</span> 2; // <span style=color:green>set</span> this to your hardware output channel size, <span style=color:green;font-weight:700>if</span> necessary
</span></span><span style=display:flex><span>    // boot the server and start SuperDirt
</span></span><span style=display:flex><span>    s.waitForBoot <span style=color:#666>{</span>
</span></span><span style=display:flex><span>        ~dirt <span style=color:#666>=</span> SuperDirt<span style=color:#666>(</span>2, s<span style=color:#666>)</span>; // two output channels, increase <span style=color:green;font-weight:700>if</span> you want to pan across more channels
</span></span><span style=display:flex><span>        ~dirt.loadSoundFiles;   // load samples <span style=color:#666>(</span>path containing a wildcard can be passed in<span style=color:#666>)</span>
</span></span><span style=display:flex><span>        // <span style=color:green;font-weight:700>for</span> example: ~dirt.loadSoundFiles<span style=color:#666>(</span><span style=color:#ba2121>&#34;/Users/myUserName/Dirt/samples/*&#34;</span><span style=color:#666>)</span>;
</span></span><span style=display:flex><span>        // s.sync; // optionally: <span style=color:green>wait</span> <span style=color:green;font-weight:700>for</span> samples to be <span style=color:green>read</span>
</span></span><span style=display:flex><span>        ~dirt.start<span style=color:#666>(</span>57120, <span style=color:#666>0</span> ! 12<span style=color:#666>)</span>;   // start listening on port 57120, create two busses each sending audio to channel <span style=color:#666>0</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        // optional, needed <span style=color:green;font-weight:700>for</span> convenient access from sclang:
</span></span><span style=display:flex><span>        <span style=color:#666>(</span>
</span></span><span style=display:flex><span>            ~d1 <span style=color:#666>=</span> ~dirt.orbits<span style=color:#666>[</span>0<span style=color:#666>]</span>; ~d2 <span style=color:#666>=</span> ~dirt.orbits<span style=color:#666>[</span>1<span style=color:#666>]</span>; ~d3 <span style=color:#666>=</span> ~dirt.orbits<span style=color:#666>[</span>2<span style=color:#666>]</span>;
</span></span><span style=display:flex><span>            ~d4 <span style=color:#666>=</span> ~dirt.orbits<span style=color:#666>[</span>3<span style=color:#666>]</span>; ~d5 <span style=color:#666>=</span> ~dirt.orbits<span style=color:#666>[</span>4<span style=color:#666>]</span>; ~d6 <span style=color:#666>=</span> ~dirt.orbits<span style=color:#666>[</span>5<span style=color:#666>]</span>;
</span></span><span style=display:flex><span>            ~d7 <span style=color:#666>=</span> ~dirt.orbits<span style=color:#666>[</span>6<span style=color:#666>]</span>; ~d8 <span style=color:#666>=</span> ~dirt.orbits<span style=color:#666>[</span>7<span style=color:#666>]</span>; ~d9 <span style=color:#666>=</span> ~dirt.orbits<span style=color:#666>[</span>8<span style=color:#666>]</span>;
</span></span><span style=display:flex><span>            ~d10 <span style=color:#666>=</span> ~dirt.orbits<span style=color:#666>[</span>9<span style=color:#666>]</span>; ~d11 <span style=color:#666>=</span> ~dirt.orbits<span style=color:#666>[</span>10<span style=color:#666>]</span>; ~d12 <span style=color:#666>=</span> ~dirt.orbits<span style=color:#666>[</span>11<span style=color:#666>]</span>;
</span></span><span style=display:flex><span>        <span style=color:#666>)</span>;
</span></span><span style=display:flex><span>    <span style=color:#666>}</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    s.latency <span style=color:#666>=</span> 0.3; // increase this <span style=color:green;font-weight:700>if</span> you get <span style=color:#ba2121>&#34;late&#34;</span> messages
</span></span><span style=display:flex><span><span style=color:#666>}</span>;
</span></span><span style=display:flex><span><span style=color:#666>)</span>;
</span></span></code></pre></td></tr></table></div></div><p>I then aliased <code>sclang</code> to the installed script in my shell startup file (<code>~/.zshrc</code>). This may or may not be required
depending on your platform.</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:green>alias</span> <span style=color:#19177c>sclang</span><span style=color:#666>=</span><span style=color:#ba2121>&#34;/Applications/SuperCollider.app/Contents/MacOS/sclang&#34;</span></span></span></code></pre></div><p>In order to use <code>vim</code> with Tidal Cycles, I installed <a href=https://github.com/tidalcycles/vim-tidal>vim-tidal</a>. Make sure
you run the <code>make</code> command to symlink the <code>tidalvim</code> and <code>tidal</code> scripts as recommended so that you can run <code>tidal</code>
in a terminal.</p><p>I then created a new <a href=https://github.com/tmuxinator/tmuxinator>tmuxinator</a> project called <code>music</code> with the following
configuration:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#408080;font-style:italic># /Users/leo/.config/tmuxinator/music.yml</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>name</span>:<span style=color:#bbb> </span>music<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>socket_name</span>:<span style=color:#bbb> </span>music<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>root</span>:<span style=color:#bbb> </span>~/projects/music<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>windows</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>editor</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>panes</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- vim<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span>- <span style=color:green;font-weight:700>server</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>      </span><span style=color:green;font-weight:700>panes</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- sclang<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>- tidal<span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p>This allows me to run <code>tmuxinator start music</code> and 2 windows open up:</p><ul><li>a main window for vim</li><li>a hidden split window running <code>sclang</code>, a &ldquo;headless&rdquo; version of SuperCollider, and <code>tidal</code>, the vim-tidal plugin
script that starts the Haskell interpreter including the tidal package</li></ul><p>Finally, by adding the following configuration line to my <code>~/.vimrc</code>, I configure vim-tidal to send commands to the
correct tmux socket and window + pane (the <code>tidal</code> pane):</p><div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-vim data-lang=vim><span style=display:flex><span><span style=color:#408080;font-style:italic>&#34; vim-tidal combined with tmuxinator music</span><span>
</span></span></span><span style=display:flex><span><span></span><span style=color:green;font-weight:700>let</span> g:tidal_default_config = {<span style=color:#ba2121>&#34;socket_name&#34;</span>: <span style=color:#ba2121>&#34;music&#34;</span>, <span style=color:#ba2121>&#34;target_pane&#34;</span>: <span style=color:#ba2121>&#34;music:2.2&#34;</span>}</span></span></code></pre></div><p>Now, I can fire up <code>vim</code> configured with SuperCollider and Tidal Cycles running with <code>tmuxinator start music</code>. When I&rsquo;m
done, I save my files and run <code>tmuxinator stop music</code>, and everything shuts down.</p></article><article><h2>cron: for your health</h2><p>I have a standing desk, but rarely stand. I have probably been sitting about 7 hours a day, which is too much! In
the spirit of positive nudges for habit building and taking ownership over my notifications,
I wrote a simple <a href=https://en.wikipedia.org/wiki/Cron>cron</a> job to remind me to stand up every hour.</p><p>Note that this is mac-specific, but a Linux or Windows analog should be fairly easy to implement.</p><p><code>~/projects/cron/standup.sh</code></p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#bc7a00>#!/usr/bin/env sh
</span></span></span><span style=display:flex><span><span style=color:#bc7a00></span>
</span></span><span style=display:flex><span>osascript -e <span style=color:#ba2121>&#39;display alert &#34;Stand up and stretch!&#34;&#39;</span>
</span></span></code></pre></td></tr></table></div></div><p>When run, a popup will be created in the middle of my screen that looks like:
<a class=img-link target=_blank href=/img/standup.jpg><figure><img style=max-width:200px src=/img/standup.jpg alt=standup.jpg></figure></a></p><p>In order to run it periodically with cron, I ran <code>crontab -e</code>, then add this line to the file:<div class=highlight><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#666>0</span> 8-17 * * * ~/projects/cron/standup.sh &gt; /dev/null 2&gt;&amp;<span style=color:#666>1</span></span></span></code></pre></div></p><p>Breakdown:</p><ul><li><code>0 8-17 * * *</code>: Run every hour from 8am to 5pm, every day (I use <a href=https://crontab.guru/>https://crontab.guru/</a> to create or parse these schedule expressions)</li><li><code>~/projects/cron/standup.sh</code>: Path to my defined alert script</li><li><code>> /dev/null</code>: Redirect stdout to <a href=https://linuxhint.com/what_is_dev_null/>/dev/null</a>, i.e. discard it</li><li><code>2>&1</code>: Disable cron email by redirecting stderr to the same place as stdout, in this case <code>/dev/null</code></li></ul></article><article><h2>local typescript sandbox</h2><p>I made a simple live-reloading Typescript sandbox, similar to the <a href=https://codesandbox.io/s/vanilla-typescript-vanilla-ts>Vanilla Typescript CodeSandbox</a>
but running locally.</p><p>You can run it with <code>node</code> installed or in a docker container.</p><p>I like having a Typescript-ready environment without having to spinup a new react app or something. CodeSandbox was nice, but got pretty laggy at times
and was hard to version control. Gluing together some tooling to scratch my own itch was fun.</p><p><a href=https://github.com/robinovitch61/typescript-sandbox>Source code</a></p><a class=img-link target=_blank href=/img/typescript-sandbox.gif><figure><img style=max-width:95% src=/img/typescript-sandbox.gif alt=typescript-sandbox.gif></figure></a></article><article><h2>rodney mullen and mastery</h2><p>Today, I fell asleep on the couch watching youtube and woke up halfway through a Rodney Mullen documentary.</p><p>Rodney Mullen, like Simone Biles in gymnastics or Derren Brown in magic, is one of the best that will ever be in their domain.
World champ at 14, inventor of the ollie and kickflip, a <a href=https://en.wikipedia.org/wiki/Rodney_Mullen>laundry list of other accolades</a>&mldr;there&rsquo;s
not much to dispute.</p><p>The podium finishers at the olympics this year in Skateboarding, while insanely skilled, won their medals doing
stuff that doesn&rsquo;t look much different than what Mullen was doing in the 80&rsquo;s.</p><p>Around 2/3 of the way through the documentary, Mullen <a href="https://www.youtube.com/watch?v=ieC_5foElVk&t=1233s">describes his process for filming a hard trick</a>.</p><blockquote><p>you have these motions that you know in your head</p></blockquote><blockquote><p>but what actually makes the trick for you is finally, you pack all that stuff for granted and you forget about it</p></blockquote><blockquote><p>then you&rsquo;re focusing only on one aspect - where my eye is and back shoulder is when I see the edge of the table &ndash; and everything else is taken for granted and runs autopilot</p></blockquote><blockquote><p>as long as I can control that one thing and get a good start, I&rsquo;ve got it</p></blockquote><blockquote><p>and that&rsquo;s how it works for me - stack stack stack stack stack, bracket and put, like, a tablecloth over it, and focus on this last little bit and that&rsquo;s what does it</p></blockquote><p>This procedural layout makes so much sense to me, and I absolutely love the stacking and tablecloth analogy bit. He&rsquo;s describing
how we all learn and progress.</p><p>Some of the physical progressions I&rsquo;ve undergone from my teens until now have really explicitly resembled this process,
albeit always at a much lower level than Mullen :)</p><ul><li>manual and tailwip a Razor Scooter</li><li>stand-up slide on a longboard</li><li>accurate foot placement during lead climbing</li><li>track stand a bike</li><li>roundoff backtuck on a spring floor</li><li>currently, gaining speed and doing cutbacks on a surfboard</li></ul><p>All of these things were accomplished by drilling fundamentals, implicitly or explicitly,
until I could put them &ldquo;under the table cloth&rdquo; - they were no longer the awkward bits that needed active attention.
Then I&rsquo;d focus on the next awkward bit that did need attention, trusting that my body would execute the rest.</p><p>Shifting the effortful to the automatic, recognizing that there&rsquo;s always the next effortful thing. If it&rsquo;s all automatic,
I&rsquo;ve stopped trying to progress.</p><p>What&rsquo;s wild is that the mechanisms of progression at insanely high levels, like where Mullen is, are more or less
the same as those at really low levels. Sure, at the high levels, there&rsquo;s probably better strategy - more thought put in to identifying the most important
effortful bits to focus on for maximum benefit, maybe with the help of coaching and videos and the like.</p><p>But what it takes to improve at a low level and what it takes to improve at the highest levels is more or less the same.
Progression is the continuous shifting of the effortful to the automatic, then incorporating it to take on the next effortful
thing. It happens at a non-linear rate, which is why there are plateaus and large jumps. People are able to progress
at different rates across different disciplines, partly due to talent and disposition and partly due to strategic approach.</p><p>This applies to less sporty things. A really interesting example is <a href=https://karpathy.ai/>Andrej Karpathy</a>, Director of AI
at Tesla. <a href="https://www.youtube.com/watch?v=609nhVzg-5Q">Here is a video of him in 2009 teaching youtube how to solve a Rubik&rsquo;s cube</a>.
The process it takes to gain mastery in solving a Rubik&rsquo;s cube is similar to that of mastering Computer Vision.</p><p>There are things that impede progression, not all of them so bad.</p><p>Jumping between disciplines is a big one. I know people, and sort of am one myself, who will build a skill tree in one domain
and then abandon it for a whole new domain. Sometimes some skills transfer, but more often you start over pretty much
from scratch. What transfers is your improved strategies for general progression, not the skills themselves. The
tradeoff between trying many things in life and getting really good at those things is real.</p><p>Boredom and burnout are common impediments, too. Looking at a discipline analytically, actively identifying your deficiencies and
targeting them until other things become your limiting factor - this can get boring! Or it can be really painful! It may suck
all the fun out of the discipline in the first place.</p><p>Another one is the harsh realization that despite your best efforts, your ability to level up in a discipline will never match the
rate you require to feel satisfied. If your love for the discipline stems from your progression
within it and not just doing the thing for its own sake, you need a rate of improvement that will satisfy you. Not everyone can
start skateboarding at 10 and be a world champion by 14. If you&rsquo;re trying your hardest to progress but still dissatisfied with
the activity, you either need to adjust your expectations, change the source of pleasure you derive from the activity, or find something
else to work on.</p><p>These days, much like my homepage banner, I&rsquo;m thinking about progression in my role in relationships, programming, and surfing. I
feel I have a good balance of satisfaction-from-progression and satisfaction-from-doing-the-thing-itself in all these things. I know that
I may switch some disciplines again in the future, but I&rsquo;m ok with that, and wouldn&rsquo;t see it as a failure. My strategies
for progression in any discipline can help carry me to where I&rsquo;d like to be, and I&rsquo;ll be sure to stop and smell the roses along the way :).</p></article><article><h2>verbify your arrows</h2><p>This is a diagram from an open source project I was evaluating at work recently, and the subsequent conversations I had:</p><a class=img-link target=_blank href=/img/noarrows.png><figure><img style=max-width:60% src=/img/noarrows.png alt=noarrows.png></figure></a><p>Me: So their solution is push based?</p><p>Coworker: No, I think they just specify the general protocol.</p><p>Me: But those lines from the squares at the top to the central circle sort of look like arrows, don&rsquo;t they? And their client pushes data&mldr;I think maybe it&rsquo;s push based?</p><p>Coworker: Yea, it&rsquo;s unclear&mldr;</p><p>Me on Slack channel of project: Hi! I&rsquo;m a n00b to this project. Is this only push based?</p><p>Project maintainers: No, our reference implementation is push based but we&rsquo;re not opinionated about it. We just specify the protocol.</p><p>Me: Cool, thanks!</p><p>&mldr;</p><p>Here are some results from googling &ldquo;architecture diagram&rdquo;:</p><a class=img-link target=_blank href=/img/manynoarrows.png><figure><img style=max-width:100% src=/img/manynoarrows.png alt=manynoarrows.png></figure></a><p>Cool. These things point to each other. I don&rsquo;t know how they relate, just apparently there&rsquo;s a directionality to their relationships.</p><p>Another one:</p><a class=img-link target=_blank href=/img/somearrows.png><figure><img style=max-width:100% src=/img/somearrows.png alt=somearrows.png></figure></a><p>This is a bit better. I know the Gateway transfers JSON over HTTP. Does it POST a JSON body from the Gateway to the arrow targets, or does the Gateway send a GET request to the arrow targets and receive a JSON response? Maybe both?</p><p>Both of these use Gateway TO arrow targets, just like the direction of the arrows, but have very different implications. If both occur, why not say so?</p><p>If I knew the domain specific context of the relationships of these entities, maybe it&rsquo;s obvious. Maybe if I thought about it more, it would become obvious. But the diagram would ideally communicate the relationships clearly without a lot of thought or inference required.</p><p>I think the best way to do this is to label your arrows, preferably with verbs and prepositions. For example:</p><ul><li>depends on</li><li>transfers to</li><li>receives from</li><li>communicates with</li><li>scrapes from</li><li>uploads to</li><li>child of</li></ul><p><strong>This is incredibly helpful, and most diagrams with arrows don&rsquo;t do this</strong>. It&rsquo;s not a revolutionary idea, but I think it can be more widely proliferated.</p><p>In the <a href=https://graphviz.gitlab.io/gallery/>graphviz gallery</a> - open source software built for making diagrams of blobs with arrows between them - almost none of the examples contain labeled arrows, despite this being a <a href=https://graphviz.org/doc/info/attrs.html#d:label>first class feature in graphviz</a>.</p><p>Here is a decent example, ~10 images into the &ldquo;architecture diagram&rdquo; image search:</p><a class=img-link target=_blank href=/img/goodarrows.png><figure><img style=max-width:100% src=/img/goodarrows.png alt=goodarrows.png></figure></a><p>Let&rsquo;s label our arrows more and communicate better, faster.</p></article><article><h2>react html5 zoom/pan canvas</h2><p>A pannable, mouse-centered zoomable, HTML5 canvas template in React + Typescript. You&rsquo;d think this would be a solved problem, but despite the plethora of solutions out there, I couldn&rsquo;t get quite what I wanted for some time. Finally, here it all is in one place for future me and others to use as boilerplate for their embedded interactive canvases in their apps.</p><p>If you see any bugs or possible improvements, please comment on the gist here:</p><p><a href=https://gist.github.com/robinovitch61/483190546bf8f0617d2cd510f3b4b86d>https://gist.github.com/robinovitch61/483190546bf8f0617d2cd510f3b4b86d</a></p><iframe src="https://codesandbox.io/embed/react-typescript-zoom-pan-html-canvas-p3itj?fontsize=14&hidenavigation=1&theme=dark" style=width:100%;height:500px;border:0;border-radius:4px;overflow:hidden title="React  Typescript Zoom Pan HTML Canvas" allow="accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking" sandbox="allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"></iframe><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">  9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">100
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">101
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">102
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">103
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">104
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">105
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">106
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">107
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">108
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">109
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">110
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">111
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">112
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">113
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">114
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">115
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">116
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">117
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">118
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">119
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">120
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">121
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">122
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">123
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">124
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">125
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">126
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">127
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">128
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">129
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">130
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">131
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">132
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">133
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">134
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">135
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">136
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">137
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">138
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">139
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">140
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">141
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">142
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">143
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">144
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">145
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">146
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">147
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">148
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">149
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">150
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">151
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">152
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">153
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">154
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">155
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">156
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">157
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">158
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">159
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">160
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">161
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">162
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">163
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">164
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">165
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">166
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">167
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">168
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">169
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">170
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">171
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">172
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">173
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">174
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">175
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">176
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">177
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">178
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">179
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">180
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">181
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">182
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">183
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">184
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">185
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">186
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">187
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">188
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">189
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">190
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">191
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">192
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">193
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">194
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">195
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">196
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">197
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">198
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">199
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">200
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">201
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">202
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">203
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">204
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">205
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">206
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">207
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">208
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">209
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">210
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">211
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">212
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">213
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">214
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">215
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">216
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">217
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">218
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">219
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">220
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">221
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">222
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">223
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">224
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">225
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">226
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">227
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">228
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">229
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">230
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">231
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">232
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">233
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">234
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">235
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">236
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">237
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">238
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">239
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">240
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">241
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">242
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">243
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">244
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">245
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">246
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:green;font-weight:700>import</span> {
</span></span><span style=display:flex><span>  useEffect,
</span></span><span style=display:flex><span>  useCallback,
</span></span><span style=display:flex><span>  useLayoutEffect,
</span></span><span style=display:flex><span>  useRef,
</span></span><span style=display:flex><span>  useState
</span></span><span style=display:flex><span>} <span style=color:green;font-weight:700>from</span> <span style=color:#ba2121>&#34;react&#34;</span>;
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>import</span> <span style=color:#666>*</span> <span style=color:green;font-weight:700>as</span> React <span style=color:green;font-weight:700>from</span> <span style=color:#ba2121>&#34;react&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>type</span> CanvasProps <span style=color:#666>=</span> {
</span></span><span style=display:flex><span>  canvasWidth: <span style=color:#b00040>number</span>;
</span></span><span style=display:flex><span>  canvasHeight: <span style=color:#b00040>number</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>type</span> Point <span style=color:#666>=</span> {
</span></span><span style=display:flex><span>  x: <span style=color:#b00040>number</span>;
</span></span><span style=display:flex><span>  y: <span style=color:#b00040>number</span>;
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>const</span> ORIGIN <span style=color:#666>=</span> <span style=color:green>Object</span>.freeze({ x: <span style=color:#b00040>0</span>, y: <span style=color:#b00040>0</span> });
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic>// adjust to device to avoid blur
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span><span style=color:green;font-weight:700>const</span> { devicePixelRatio: <span style=color:#b00040>ratio</span> <span style=color:#666>=</span> <span style=color:#666>1</span> } <span style=color:#666>=</span> <span style=color:green>window</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>function</span> diffPoints(p1: <span style=color:#b00040>Point</span>, p2: <span style=color:#b00040>Point</span>) {
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>return</span> { x: <span style=color:#b00040>p1.x</span> <span style=color:#666>-</span> p2.x, y: <span style=color:#b00040>p1.y</span> <span style=color:#666>-</span> p2.y };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>function</span> addPoints(p1: <span style=color:#b00040>Point</span>, p2: <span style=color:#b00040>Point</span>) {
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>return</span> { x: <span style=color:#b00040>p1.x</span> <span style=color:#666>+</span> p2.x, y: <span style=color:#b00040>p1.y</span> <span style=color:#666>+</span> p2.y };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>function</span> scalePoint(p1: <span style=color:#b00040>Point</span>, scale: <span style=color:#b00040>number</span>) {
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>return</span> { x: <span style=color:#b00040>p1.x</span> <span style=color:#666>/</span> scale, y: <span style=color:#b00040>p1.y</span> <span style=color:#666>/</span> scale };
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>const</span> ZOOM_SENSITIVITY <span style=color:#666>=</span> <span style=color:#666>500</span>; <span style=color:#408080;font-style:italic>// bigger for lower zoom per scroll
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:green;font-weight:700>export</span> <span style=color:green;font-weight:700>default</span> <span style=color:green;font-weight:700>function</span> Canvas(props: <span style=color:#b00040>CanvasProps</span>) {
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>const</span> canvasRef <span style=color:#666>=</span> useRef&lt;<span style=color:green;font-weight:700>HTMLCanvasElement</span>&gt;(<span style=color:green;font-weight:700>null</span>);
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>const</span> [context, setContext] <span style=color:#666>=</span> useState&lt;<span style=color:green;font-weight:700>CanvasRenderingContext2D</span> <span>|</span> <span style=color:#7d9029>null</span>&gt;(<span style=color:green;font-weight:700>null</span>);
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>const</span> [scale, setScale] <span style=color:#666>=</span> useState&lt;<span style=color:green;font-weight:700>number</span>&gt;(<span style=color:#666>1</span>);
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>const</span> [offset, setOffset] <span style=color:#666>=</span> useState&lt;<span style=color:green;font-weight:700>Point</span>&gt;(ORIGIN);
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>const</span> [mousePos, setMousePos] <span style=color:#666>=</span> useState&lt;<span style=color:green;font-weight:700>Point</span>&gt;(ORIGIN);
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>const</span> [viewportTopLeft, setViewportTopLeft] <span style=color:#666>=</span> useState&lt;<span style=color:green;font-weight:700>Point</span>&gt;(ORIGIN);
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>const</span> isResetRef <span style=color:#666>=</span> useRef&lt;<span style=color:green;font-weight:700>boolean</span>&gt;(<span style=color:green;font-weight:700>false</span>);
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>const</span> lastMousePosRef <span style=color:#666>=</span> useRef&lt;<span style=color:green;font-weight:700>Point</span>&gt;(ORIGIN);
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>const</span> lastOffsetRef <span style=color:#666>=</span> useRef&lt;<span style=color:green;font-weight:700>Point</span>&gt;(ORIGIN);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#408080;font-style:italic>// update last offset
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>  useEffect(() <span style=color:#666>=&gt;</span> {
</span></span><span style=display:flex><span>    lastOffsetRef.current <span style=color:#666>=</span> offset;
</span></span><span style=display:flex><span>  }, [offset]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#408080;font-style:italic>// reset
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>  <span style=color:green;font-weight:700>const</span> reset <span style=color:#666>=</span> useCallback(
</span></span><span style=display:flex><span>    (context: <span style=color:#b00040>CanvasRenderingContext2D</span>) <span style=color:#666>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:green;font-weight:700>if</span> (context <span style=color:#666>&amp;&amp;</span> <span style=color:#666>!</span>isResetRef.current) {
</span></span><span style=display:flex><span>        <span style=color:#408080;font-style:italic>// adjust for device pixel density
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>        context.canvas.width <span style=color:#666>=</span> props.canvasWidth <span style=color:#666>*</span> ratio;
</span></span><span style=display:flex><span>        context.canvas.height <span style=color:#666>=</span> props.canvasHeight <span style=color:#666>*</span> ratio;
</span></span><span style=display:flex><span>        context.scale(ratio, ratio);
</span></span><span style=display:flex><span>        setScale(<span style=color:#666>1</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#408080;font-style:italic>// reset state and refs
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>        setContext(context);
</span></span><span style=display:flex><span>        setOffset(ORIGIN);
</span></span><span style=display:flex><span>        setMousePos(ORIGIN);
</span></span><span style=display:flex><span>        setViewportTopLeft(ORIGIN);
</span></span><span style=display:flex><span>        lastOffsetRef.current <span style=color:#666>=</span> ORIGIN;
</span></span><span style=display:flex><span>        lastMousePosRef.current <span style=color:#666>=</span> ORIGIN;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#408080;font-style:italic>// this thing is so multiple resets in a row don&#39;t clear canvas
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>        isResetRef.current <span style=color:#666>=</span> <span style=color:green;font-weight:700>true</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    [props.canvasWidth, props.canvasHeight]
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#408080;font-style:italic>// functions for panning
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>  <span style=color:green;font-weight:700>const</span> mouseMove <span style=color:#666>=</span> useCallback(
</span></span><span style=display:flex><span>    (event: <span style=color:#b00040>MouseEvent</span>) <span style=color:#666>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:green;font-weight:700>if</span> (context) {
</span></span><span style=display:flex><span>        <span style=color:green;font-weight:700>const</span> lastMousePos <span style=color:#666>=</span> lastMousePosRef.current;
</span></span><span style=display:flex><span>        <span style=color:green;font-weight:700>const</span> currentMousePos <span style=color:#666>=</span> { x: <span style=color:#b00040>event.pageX</span>, y: <span style=color:#b00040>event.pageY</span> }; <span style=color:#408080;font-style:italic>// use document so can pan off element
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>        lastMousePosRef.current <span style=color:#666>=</span> currentMousePos;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:green;font-weight:700>const</span> mouseDiff <span style=color:#666>=</span> diffPoints(currentMousePos, lastMousePos);
</span></span><span style=display:flex><span>        setOffset((prevOffset) <span style=color:#666>=&gt;</span> addPoints(prevOffset, mouseDiff));
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    [context]
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>const</span> mouseUp <span style=color:#666>=</span> useCallback(() <span style=color:#666>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:green>document</span>.removeEventListener(<span style=color:#ba2121>&#34;mousemove&#34;</span>, mouseMove);
</span></span><span style=display:flex><span>    <span style=color:green>document</span>.removeEventListener(<span style=color:#ba2121>&#34;mouseup&#34;</span>, mouseUp);
</span></span><span style=display:flex><span>  }, [mouseMove]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>const</span> startPan <span style=color:#666>=</span> useCallback(
</span></span><span style=display:flex><span>    (event: <span style=color:#b00040>React.MouseEvent</span>&lt;<span style=color:green;font-weight:700>HTMLCanvasElement</span><span>,</span> <span style=color:#7d9029>MouseEvent</span>&gt;) <span style=color:#666>=&gt;</span> {
</span></span><span style=display:flex><span>      <span style=color:green>document</span>.addEventListener(<span style=color:#ba2121>&#34;mousemove&#34;</span>, mouseMove);
</span></span><span style=display:flex><span>      <span style=color:green>document</span>.addEventListener(<span style=color:#ba2121>&#34;mouseup&#34;</span>, mouseUp);
</span></span><span style=display:flex><span>      lastMousePosRef.current <span style=color:#666>=</span> { x: <span style=color:#b00040>event.pageX</span>, y: <span style=color:#b00040>event.pageY</span> };
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    [mouseMove, mouseUp]
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#408080;font-style:italic>// setup canvas and set context
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>  useLayoutEffect(() <span style=color:#666>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>if</span> (canvasRef.current) {
</span></span><span style=display:flex><span>      <span style=color:#408080;font-style:italic>// get new drawing context
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>      <span style=color:green;font-weight:700>const</span> renderCtx <span style=color:#666>=</span> canvasRef.current.getContext(<span style=color:#ba2121>&#34;2d&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:green;font-weight:700>if</span> (renderCtx) {
</span></span><span style=display:flex><span>        reset(renderCtx);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }, [reset, props.canvasHeight, props.canvasWidth]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#408080;font-style:italic>// pan when offset or scale changes
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>  useLayoutEffect(() <span style=color:#666>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>if</span> (context <span style=color:#666>&amp;&amp;</span> lastOffsetRef.current) {
</span></span><span style=display:flex><span>      <span style=color:green;font-weight:700>const</span> offsetDiff <span style=color:#666>=</span> scalePoint(
</span></span><span style=display:flex><span>        diffPoints(offset, lastOffsetRef.current),
</span></span><span style=display:flex><span>        scale
</span></span><span style=display:flex><span>      );
</span></span><span style=display:flex><span>      context.translate(offsetDiff.x, offsetDiff.y);
</span></span><span style=display:flex><span>      setViewportTopLeft((prevVal) <span style=color:#666>=&gt;</span> diffPoints(prevVal, offsetDiff));
</span></span><span style=display:flex><span>      isResetRef.current <span style=color:#666>=</span> <span style=color:green;font-weight:700>false</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }, [context, offset, scale]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#408080;font-style:italic>// draw
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>  useLayoutEffect(() <span style=color:#666>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>if</span> (context) {
</span></span><span style=display:flex><span>      <span style=color:green;font-weight:700>const</span> squareSize <span style=color:#666>=</span> <span style=color:#666>20</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#408080;font-style:italic>// clear canvas but maintain transform
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>      <span style=color:green;font-weight:700>const</span> storedTransform <span style=color:#666>=</span> context.getTransform();
</span></span><span style=display:flex><span>      context.canvas.width <span style=color:#666>=</span> context.canvas.width;
</span></span><span style=display:flex><span>      context.setTransform(storedTransform);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      context.fillRect(
</span></span><span style=display:flex><span>        props.canvasWidth <span style=color:#666>/</span> <span style=color:#666>2</span> <span style=color:#666>-</span> squareSize <span style=color:#666>/</span> <span style=color:#666>2</span>,
</span></span><span style=display:flex><span>        props.canvasHeight <span style=color:#666>/</span> <span style=color:#666>2</span> <span style=color:#666>-</span> squareSize <span style=color:#666>/</span> <span style=color:#666>2</span>,
</span></span><span style=display:flex><span>        squareSize,
</span></span><span style=display:flex><span>        squareSize
</span></span><span style=display:flex><span>      );
</span></span><span style=display:flex><span>      context.arc(viewportTopLeft.x, viewportTopLeft.y, <span style=color:#666>5</span>, <span style=color:#666>0</span>, <span style=color:#666>2</span> <span style=color:#666>*</span> <span style=color:green>Math</span>.PI);
</span></span><span style=display:flex><span>      context.fillStyle <span style=color:#666>=</span> <span style=color:#ba2121>&#34;red&#34;</span>;
</span></span><span style=display:flex><span>      context.fill();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }, [
</span></span><span style=display:flex><span>    props.canvasWidth,
</span></span><span style=display:flex><span>    props.canvasHeight,
</span></span><span style=display:flex><span>    context,
</span></span><span style=display:flex><span>    scale,
</span></span><span style=display:flex><span>    offset,
</span></span><span style=display:flex><span>    viewportTopLeft
</span></span><span style=display:flex><span>  ]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#408080;font-style:italic>// add event listener on canvas for mouse position
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>  useEffect(() <span style=color:#666>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>const</span> canvasElem <span style=color:#666>=</span> canvasRef.current;
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>if</span> (canvasElem <span style=color:#666>===</span> <span style=color:green;font-weight:700>null</span>) {
</span></span><span style=display:flex><span>      <span style=color:green;font-weight:700>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>function</span> handleUpdateMouse(event: <span style=color:#b00040>MouseEvent</span>) {
</span></span><span style=display:flex><span>      event.preventDefault();
</span></span><span style=display:flex><span>      <span style=color:green;font-weight:700>if</span> (canvasRef.current) {
</span></span><span style=display:flex><span>        <span style=color:green;font-weight:700>const</span> viewportMousePos <span style=color:#666>=</span> { x: <span style=color:#b00040>event.clientX</span>, y: <span style=color:#b00040>event.clientY</span> };
</span></span><span style=display:flex><span>        <span style=color:green;font-weight:700>const</span> topLeftCanvasPos <span style=color:#666>=</span> {
</span></span><span style=display:flex><span>          x: <span style=color:#b00040>canvasRef.current.offsetLeft</span>,
</span></span><span style=display:flex><span>          y: <span style=color:#b00040>canvasRef.current.offsetTop</span>
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>        setMousePos(diffPoints(viewportMousePos, topLeftCanvasPos));
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    canvasElem.addEventListener(<span style=color:#ba2121>&#34;mousemove&#34;</span>, handleUpdateMouse);
</span></span><span style=display:flex><span>    canvasElem.addEventListener(<span style=color:#ba2121>&#34;wheel&#34;</span>, handleUpdateMouse);
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>return</span> () <span style=color:#666>=&gt;</span> {
</span></span><span style=display:flex><span>      canvasElem.removeEventListener(<span style=color:#ba2121>&#34;mousemove&#34;</span>, handleUpdateMouse);
</span></span><span style=display:flex><span>      canvasElem.removeEventListener(<span style=color:#ba2121>&#34;wheel&#34;</span>, handleUpdateMouse);
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  }, []);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#408080;font-style:italic>// add event listener on canvas for zoom
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>  useEffect(() <span style=color:#666>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>const</span> canvasElem <span style=color:#666>=</span> canvasRef.current;
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>if</span> (canvasElem <span style=color:#666>===</span> <span style=color:green;font-weight:700>null</span>) {
</span></span><span style=display:flex><span>      <span style=color:green;font-weight:700>return</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#408080;font-style:italic>// this is tricky. Update the viewport&#39;s &#34;origin&#34; such that
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>    <span style=color:#408080;font-style:italic>// the mouse doesn&#39;t move during scale - the &#39;zoom point&#39; of the mouse
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>    <span style=color:#408080;font-style:italic>// before and after zoom is relatively the same position on the viewport
</span></span></span><span style=display:flex><span><span style=color:#408080;font-style:italic></span>    <span style=color:green;font-weight:700>function</span> handleWheel(event: <span style=color:#b00040>WheelEvent</span>) {
</span></span><span style=display:flex><span>      event.preventDefault();
</span></span><span style=display:flex><span>      <span style=color:green;font-weight:700>if</span> (context) {
</span></span><span style=display:flex><span>        <span style=color:green;font-weight:700>const</span> zoom <span style=color:#666>=</span> <span style=color:#666>1</span> <span style=color:#666>-</span> event.deltaY <span style=color:#666>/</span> ZOOM_SENSITIVITY;
</span></span><span style=display:flex><span>        <span style=color:green;font-weight:700>const</span> viewportTopLeftDelta <span style=color:#666>=</span> {
</span></span><span style=display:flex><span>          x<span style=color:#666>:</span> (mousePos.x <span style=color:#666>/</span> scale) <span style=color:#666>*</span> (<span style=color:#666>1</span> <span style=color:#666>-</span> <span style=color:#666>1</span> <span style=color:#666>/</span> zoom),
</span></span><span style=display:flex><span>          y<span style=color:#666>:</span> (mousePos.y <span style=color:#666>/</span> scale) <span style=color:#666>*</span> (<span style=color:#666>1</span> <span style=color:#666>-</span> <span style=color:#666>1</span> <span style=color:#666>/</span> zoom)
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>        <span style=color:green;font-weight:700>const</span> newViewportTopLeft <span style=color:#666>=</span> addPoints(
</span></span><span style=display:flex><span>          viewportTopLeft,
</span></span><span style=display:flex><span>          viewportTopLeftDelta
</span></span><span style=display:flex><span>        );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        context.translate(viewportTopLeft.x, viewportTopLeft.y);
</span></span><span style=display:flex><span>        context.scale(zoom, zoom);
</span></span><span style=display:flex><span>        context.translate(<span style=color:#666>-</span>newViewportTopLeft.x, <span style=color:#666>-</span>newViewportTopLeft.y);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        setViewportTopLeft(newViewportTopLeft);
</span></span><span style=display:flex><span>        setScale(scale <span style=color:#666>*</span> zoom);
</span></span><span style=display:flex><span>        isResetRef.current <span style=color:#666>=</span> <span style=color:green;font-weight:700>false</span>;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    canvasElem.addEventListener(<span style=color:#ba2121>&#34;wheel&#34;</span>, handleWheel);
</span></span><span style=display:flex><span>    <span style=color:green;font-weight:700>return</span> () <span style=color:#666>=&gt;</span> canvasElem.removeEventListener(<span style=color:#ba2121>&#34;wheel&#34;</span>, handleWheel);
</span></span><span style=display:flex><span>  }, [context, mousePos.x, mousePos.y, viewportTopLeft, scale]);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:green;font-weight:700>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:green;font-weight:700>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:green;font-weight:700>button</span> <span style=color:#7d9029>onClick</span><span style=color:#666>=</span>{() <span style=color:#666>=&gt;</span> context <span style=color:#666>&amp;&amp;</span> reset(context)}&gt;Reset&lt;/<span style=color:green;font-weight:700>button</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:green;font-weight:700>pre</span>&gt;scale<span style=color:#666>:</span> {scale}&lt;/<span style=color:green;font-weight:700>pre</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:green;font-weight:700>pre</span>&gt;offset<span style=color:#666>:</span> {JSON.stringify(offset)}&lt;/<span style=color:green;font-weight:700>pre</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:green;font-weight:700>pre</span>&gt;viewportTopLeft<span style=color:#666>:</span> {JSON.stringify(viewportTopLeft)}&lt;/<span style=color:green;font-weight:700>pre</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:green;font-weight:700>canvas</span>
</span></span><span style=display:flex><span>        <span style=color:#7d9029>onMouseDown</span><span style=color:#666>=</span>{startPan}
</span></span><span style=display:flex><span>        <span style=color:#7d9029>ref</span><span style=color:#666>=</span>{canvasRef}
</span></span><span style=display:flex><span>        <span style=color:#7d9029>width</span><span style=color:#666>=</span>{props.canvasWidth <span style=color:#666>*</span> ratio}
</span></span><span style=display:flex><span>        <span style=color:#7d9029>height</span><span style=color:#666>=</span>{props.canvasHeight <span style=color:#666>*</span> ratio}
</span></span><span style=display:flex><span>        <span style=color:#7d9029>style</span><span style=color:#666>=</span>{{
</span></span><span style=display:flex><span>          border<span style=color:#666>:</span> <span style=color:#ba2121>&#34;2px solid #000&#34;</span>,
</span></span><span style=display:flex><span>          width<span style=color:#666>:</span> <span style=color:#ba2121>`</span><span style=color:#b68;font-weight:700>${</span>props.canvasWidth<span style=color:#b68;font-weight:700>}</span><span style=color:#ba2121>px`</span>,
</span></span><span style=display:flex><span>          height<span style=color:#666>:</span> <span style=color:#ba2121>`</span><span style=color:#b68;font-weight:700>${</span>props.canvasHeight<span style=color:#b68;font-weight:700>}</span><span style=color:#ba2121>px`</span>
</span></span><span style=display:flex><span>        }}
</span></span><span style=display:flex><span>      &gt;&lt;/<span style=color:green;font-weight:700>canvas</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:green;font-weight:700>div</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div></article><article><h2>code and plant advents</h2><p>Last month, I participated in <a href=https://adventofcode.com/>advent of code</a> for the first time. Everyday from Dec 1st through 25th, a problem is released. Each problem requires some programming to solve, and is split into two separate but related parts.</p><p>The problem statements link to an overarching narrative involving a character going on vacation and encountering a number of technical difficulties, e.g. implementing a ticket reader for the train or a fixing the boot code in your neighbours airplane video game console.</p><p>It was good to do some problem solving practice in this fun semi-communal way - discussing with others after was half the fun. The problems are a race to solve, but I approached it as just trying to solve them throughout the month and not really caring about my rank.</p><p>I took the opportunity to learn some new language syntax and improve on my existing knowledge, doing the first 10 different problems in 10 different languages (or at least, file extension types :D)</p><ul><li>python - classic</li><li>typescript - love it</li><li>bash - do not love it, but respect it</li><li>scala - love it</li><li>javascript - naked typescript</li><li>racket - new to me, my first foray into Lisp, and loved it</li><li>go - new to me, easy to learn syntax, generally enjoyable</li><li>clojure - new to me, but easy to learn and use after Racket</li><li>elm - new to me, hard to setup to just run scripts, enjoyable to learn and use after setup</li><li>rust - good refresher, actually got some better insight into mutability/move/borrow and stuff this time around</li></ul><p>After the first 10, I switched to using Python for the rest in order to get through them in a reasonable time.</p><p>I went camping for the last half of December. The night before I left, I nailed the first half of Problem 20 (the seamonster problem), finishing sub-800! Confidence bolstered, I was then destroyed by the 2nd half of the problem, and had to leave defeated :). I plan to finish the last 5.5 problems before this December rolls around.</p><p>It was also the time of year again for my friend&rsquo;s annual gift exchange, for which I was determined to <a href=https://theleo.zone/posts/gifting-websites/>gift another website</a>.</p><p>I got my friend Matt&rsquo;s name out of a hat. Matt primarily loves bikes and plants, and I went with plants.</p><p>The result is <a href=/matts-garden>matt.garden</a>, an interactive, animated, svg-laden 10 day advent calendar of plants, many of which Matt has in his real garden.</p><a class=img-link target=_blank href=/img/matt-garden.png><figure><img style=max-width:100% src=/img/matt-garden.png alt=matt-garden.png></figure></a><p>It was super fun to build, and involved way more art than code in the end. An artiste, I am not, so I watched a lot of Inkscape and design tutorials on youtube and did my best to keep things simple and cute.</p><p><a href=https://inkscape.org/>Inkscape</a> is awesome - free and open source software, quite capable and performant, XML editor for adding <code>class</code> and <code>id</code> to groups and elements for easy css animation, and generally just a pleasure to work with.</p><p>It was fun to learn css animation more in depth too! I may have gone a bit overboard with it - things look a bit janky on my Brave browser in desktop, but Safari on mobile seems to take it all in stride.</p><p>Overall, a good month of daily activities to finish out 2020.</p></article><article><h2>giving what we can pledge</h2><p>This is a bit of an uncomfortable public post for me. Talking about money in general can be uncomfortable, and talking about <em>giving</em> money can just come off as self-congratulatory. But I think it&rsquo;s an important topic that will have positive impact when talked about more often.</p><p>I&rsquo;ve been excited about <a href=https://www.givewell.org>GiveWell</a> for <a href=https://theleo.zone/posts/givewell-is-awesome/>a while now</a>, and am interested in exploring the idea of doing the most good with money, time and effort. This post focuses on doing good through giving money. Many of these ideas are ellaborated on in <a href=https://samharris.org/podcasts/228-doing-good/>Sam Harris&rsquo; recent podcast with Will MacAskill</a>.</p><p>The discussion of where, how, and how much to give isn&rsquo;t particularly new. The Jewish scholar Maimonides discussed the <a href=https://www.jewishvirtuallibrary.org/eight-levels-of-charitable-giving>levels of charitable giving</a>, assigning moral weight to different classes of giving. Some of his metrics aren&rsquo;t great - donor emotional state, anonymity, and reciprocity don&rsquo;t intuitively seem like reliable indicators of better or worse giving. Other metrics, like amount, context, and necessity seem reasonable.</p><p>Philosophers Peter Singer, Will MacAskill, and others continue the conversation around doing the most good possible these days. While I claim very few of the answers to large and important problems, I tend to skew Utilitarian when thinking about them. <a href=https://www.centreforeffectivealtruism.org/>Effective Altruism&rsquo;s</a> goal of &ldquo;using evidence and reason to figure out how to benefit others as much as possible&rdquo; seems like the right one to me.</p><p>I currently have limited ability to determine the most effective things to throw money at. I don&rsquo;t research it full-time and I&rsquo;m not particularly educated in the field. Lucky for me, people with lots of experience that do work on this full time publish their findings, like <a href=https://www.givingwhatwecan.org/get-involved/myths-about-aid/>myths about aid</a>, <a href=https://www.givewell.org/maximum-impact-fund>&ldquo;index-fund&rdquo; like aggregations of effective charities</a>, and <a href="https://docs.google.com/spreadsheets/d/16XOOB1oWse1ICbF0OVXUYtwWwpvG3mxAAQ6LYAAndQU/edit#gid=1377543212">spreadsheets of cost effective analysis&rsquo;</a>.</p><p>If this stuff sounds kind of boring, that&rsquo;s because it can be boring. It&rsquo;s genuinely harder to get excited about deworming programs or malaria bed nets than it is about tearing down an evil person or supporting something cute.</p><p>Given that effective stuff can sometimes be unexciting, less effective stuff highly attention grabbing, and the <a href=https://www.givingwhatwecan.org/charity-comparisons/>massive difference</a> the impact your money has depending on where you give, I&rsquo;ve decided to be ok with my giving being boring as long as it&rsquo;s effective.</p><p>My financial situation is good. I&rsquo;ve been working full-time now since 2017 with a brief pause last year. I&rsquo;m making more than enough to take care of my essential needs, undergo financial setbacks without dire consequence, and sock some away for retirement. I&rsquo;m well above the <a href="https://www.washingtonpost.com/magazine/2020/09/23/effective-altruism-charity/?arc404=true">$58k USD/year salary</a> required to be in the top 1% income bracket globally, and have pretty much in every way won the birth location, family, and opportunity lotteries.</p><p>Reflecting on this over the years, the reality of my vast riches and privilege on a global scale became intimidating as it set in. What responsibility comes with relative wealth? I have a responsibility to myself and my future dependents, but it&rsquo;s very likely that I&rsquo;ll get by in that area. There&rsquo;s almost surely more I could do with money to influence the world in a positive direction. It&rsquo;s certain that people with much less than me are giving more - how can I justify this? Will I ever be in a position where giving just feels easy and obvious, or will I have to inevitably push through some emotional discomfort to make it happen?</p><p>As these thoughts became louder, I ramped up my giving slowly. I gave about 1-2% of my pre-tax income in 2017/18/19, which wasn&rsquo;t great but started to set the tone and made it less intimidating. I did a decent job upping this in 2020, ending the year with 7.25% of my pre-tax and 12.9% of my post-tax income donated to effective causes.</p><p>Today, I signed the <a href=https://www.givingwhatwecan.org/pledge/>Giving What We Can Pledge</a> to donate at minimum 10% of my pre-tax income to effective causes. I&rsquo;ll be donating to <a href=https://www.givewell.org/maximum-impact-fund>GiveWell&rsquo;s Maximum Impact Fund</a> for the forseeable future, as I trust this organization to funnel cash to the desired extremely effective (albeit possibly unstimulating) causes I&rsquo;d like to target.</p><p>I encourage others who find themselves fortunate enough to give without serious detriment to their well-being to take the pledge as well. If you&rsquo;re uncomfortable with jumping right to 10%, strategies for increasing giving incrementally could include:</p><ul><li>Start with the <a href="https://app.effectivealtruism.org/pledge/take?pledgeType=trygiving">Try Giving</a> pledge, committing to a minimum of 1% of your pre-tax salary given to effective charities.</li><li>Commit something like 20-50% of your future raises/increased earnings to effective charities, up until you meet 10% of your (future, increased) pre-tax income.</li></ul><p>I also encourage others to talk about giving habits more with others in similar positions. If you get only one other person excited about giving, you may have doubled your own impact (!), as well as pointed them in the direction of a more rich, fulfilling life.</p></article><article><h2>css shapes</h2><p>Today I spent some time learning more about how to draw with css. You can make a lot of shapes and designs with only css! I went off of <a target=_blank href=https://css-tricks.com/the-shapes-of-css/>https://css-tricks.com/the-shapes-of-css/</a>.</p><style>.wrapper{display:flex;flex-wrap:wrap}.shape{margin:30px;height:max-content}#circle{width:100px;height:100px;background-color:#000;border-radius:50%}#oval{width:200px;height:100px;background-color:#000;border-radius:50%}#triangle-up{width:0;height:0;border-bottom:100px solid #000;border-left:60px solid transparent;border-right:60px solid transparent}#triangle-down{width:0;height:0;border-top:100px solid #000;border-left:60px solid transparent;border-right:60px solid transparent}#triangle-left{width:0;height:0;border-right:100px solid #000;border-top:60px solid transparent;border-bottom:60px solid transparent}#triangle-right{width:0;height:0;border-left:100px solid #000;border-top:60px solid transparent;border-bottom:60px solid transparent}#border-explainer-middle{width:50px;height:50px;background-color:blue;border-top:25px solid red;border-right:25px solid green;border-left:25px solid #000;border-bottom:25px solid orange}#border-explainer{width:50px;height:50px;background-color:blue;border-top:20px solid red;border-right:20px solid green;border-left:50px solid #000;border-bottom:50px solid orange}#triangle-top-left{width:0;height:0;border-left:100px solid #000;border-bottom:100px solid transparent}#triangle-top-right{width:0;height:0;border-right:100px solid #000;border-bottom:100px solid transparent}#triangle-bottom-left{width:0;height:0;border-left:100px solid #000;border-top:100px solid transparent}#triangle-bottom-right{width:0;height:0;border-right:100px solid #000;border-top:100px solid transparent}#trapezoid-explainer{width:50px;border-left:40px solid red;border-right:40px solid blue;border-bottom:80px solid #000}#trapezoid{width:50px;border-left:40px solid transparent;border-right:40px solid transparent;border-bottom:80px solid #000}#parallelogram{width:120px;height:80px;background-color:#000;transform:skew(20deg)}#star-of-david{width:0;height:0;border-bottom:80px solid #000;border-left:45px solid transparent;border-right:45px solid transparent;position:relative}#star-of-david::after{content:"";width:0;height:0;border-top:80px solid #000;border-left:45px solid transparent;border-right:45px solid transparent;position:absolute;top:25px;left:-45px}#goy-star{width:0;height:0;margin-left:40px;border-bottom:40px solid #000;border-left:15px solid transparent;border-right:15px solid transparent;position:relative}#goy-star::after{content:"";width:0;height:0;border-bottom:35px solid #000;border-left:50px solid transparent;border-right:50px solid transparent;transform:rotate(35deg);position:absolute;top:30px;left:-50px}#goy-star::before{content:"";width:0;height:0;border-bottom:35px solid #000;border-left:50px solid transparent;border-right:50px solid transparent;transform:rotate(-35deg);position:absolute;top:30px;left:-50px}#pentagon{width:0;height:0;border-bottom:50px solid #000;border-left:55px solid transparent;border-right:55px solid transparent;position:relative}#pentagon::after{content:"";width:60px;height:0;border-top:55px solid #000;border-left:25px solid transparent;border-right:25px solid transparent;position:absolute;top:50px;left:-55px}#hexagon{width:100px;height:50px;background-color:#000;position:relative;transform:translateY(30px)}#hexagon::after{content:"";width:0;height:0;border-bottom:30px solid #000;border-left:50px solid transparent;border-right:50px solid transparent;position:absolute;top:-30px}#hexagon::before{content:"";width:0;height:0;border-top:30px solid #000;border-left:50px solid transparent;border-right:50px solid transparent;position:absolute;top:50px}#octagon{width:100px;height:40px;background-color:#000;position:relative;transform:translateY(30px)}#octagon::after{content:"";width:40px;height:0;border-bottom:30px solid #000;border-left:30px solid transparent;border-right:30px solid transparent;position:absolute;top:-30px}#octagon::before{content:"";width:40px;height:0;border-top:30px solid #000;border-left:30px solid transparent;border-right:30px solid transparent;position:absolute;top:40px}#heart{width:65px;height:100px;border-radius:50px 50px 0 0;background-color:#000;transform:translateX(30px)rotate(45deg);position:relative}#heart::after{content:"";width:65px;height:100px;border-radius:50px 50px 0 0;background-color:#000;transform:rotate(-90deg);transform-origin:100% 100%;position:absolute;top:-60px}#infinity{width:60px;height:60px;border:25px solid #000;border-radius:80px 0 80px 80px;transform:translateX(30px)rotate(45deg);position:relative}#infinity::after{content:"";width:60px;height:60px;border:25px solid #000;border-radius:80px 80px 80px 0;position:absolute;transform-origin:100% 100%;top:-110px;right:-110px}#egg{margin-left:150px;height:100px;width:70px;background-color:#000;border-radius:50%/60% 60% 40% 40%}#pacman{width:0;height:0;border:50px solid #000;border-right:50px solid transparent;border-radius:50%}#speech-bubble{width:130px;height:80px;background-color:#000;border-radius:10px;position:relative;color:#fff;text-align:center;line-height:80px;font-family:wingdings}#speech-bubble::after{content:"";width:0;height:0;border:20px solid transparent;border-right:20px solid #000;position:absolute;left:-40px;top:20px}#flag{width:0;height:0;border:40px solid #000;border-bottom:10px solid transparent}#lock{width:120px;height:80px;background-color:#000;border-radius:10%;position:relative}#lock::after{content:"";width:60px;height:30px;border:15px solid #000;border-radius:50% 50% 0 0;position:absolute;top:-40px;left:15px}#lock::before{content:"";width:10px;height:30px;background-color:#fff;border-radius:20%;position:absolute;left:55px;top:25px}#cross{width:100px;height:15px;background-color:#000;border-radius:5px;position:relative;top:20px}#cross::after{content:"";width:100px;height:15px;background-color:#000;border-radius:5px;transform:rotate(90deg);position:absolute}#cone{width:0;height:0;background-color:0;border:80px solid transparent;border-top:100px solid #000;border-bottom:0;border-radius:50%}#fartbook{width:80px;height:80px;overflow:hidden;border-top:15px solid #000;border-right:15px solid #000;border-radius:5px;background-color:#000;position:relative}#fartbook::after{content:"";width:40px;height:80px;border:15px solid #fff;border-radius:20px;position:absolute;left:60%;top:20%}#fartbook::before{content:"";width:35px;height:14px;background-color:#fff;position:absolute;left:50%;top:55%}#magnifying-glass{width:60px;height:60px;border:10px solid #000;border-radius:50%;position:relative}#magnifying-glass::after{content:"";width:40px;height:10px;background-color:#000;border-radius:15%;position:absolute;transform:rotate(45deg);top:100%;left:80%}#chevron{width:100px;height:50px;position:relative}#chevron::before{content:"";height:30px;width:50%;background-color:#000;transform:skew(0,20deg);position:absolute}#chevron::after{content:"";height:30px;left:50%;width:50%;background-color:#000;transform:skew(0,-20deg);position:absolute}#yin-yang{width:50px;height:100px;border:2px solid #000;border-right:50px solid #000;border-radius:50%;position:relative}#yin-yang::after{content:"";width:12px;height:12px;background-color:#fff;border:19px solid #000;border-radius:50%;position:absolute;top:50%;left:50%}#yin-yang::before{content:"";width:12px;height:12px;background-color:#000;border:19px solid #fff;border-radius:50%;position:absolute;left:50%}</style><div class=wrapper><div class=shape id=circle></div><div class=shape id=oval></div><div class=shape id=triangle-up></div><div class=shape id=triangle-down></div><div class=shape id=triangle-left></div><div class=shape id=triangle-right></div><div class=shape id=border-explainer-middle></div><div class=shape id=border-explainer></div><div class=shape id=triangle-top-left></div><div class=shape id=triangle-top-right></div><div class=shape id=triangle-bottom-left></div><div class=shape id=triangle-bottom-right></div><div class=shape id=trapezoid-explainer></div><div class=shape id=trapezoid></div><div class=shape id=parallelogram></div><div class=shape id=star-of-david></div><div class=shape id=goy-star></div><div class=shape id=pentagon></div><div class=shape id=hexagon></div><div class=shape id=octagon></div><div class=shape id=heart></div><div class=shape id=infinity></div><div class=shape id=egg></div><div class=shape id=pacman></div><div class=shape id=speech-bubble>nomnom</div><div class=shape id=flag></div><div class=shape id=lock></div><div class=shape id=cross></div><div class=shape id=cone></div><div class=shape id=fartbook></div><div class=shape id=magnifying-glass></div><div class=shape id=chevron></div><div class=shape id=yin-yang></div></div></article><article><h2>color commentary</h2><a class=img-link target=_blank href=/img/cc_collage.png><figure><img style=max-width:120% src=/img/cc_collage.png alt=cc_collage.png><figcaption class=figcaption-text>Twitter bird - blue or purple?</figcaption></figure></a><p>About 6 weeks ago, I launched <a href=https://colorcontroversy.com>colorcontroversy.com</a>. Since then, the site has collected over 800,000 color judgements and been shared around the web more than I expected.</p><p>A much-simplified version of Randal Monroe of XKCD&rsquo;s <a href=https://blog.xkcd.com/2010/05/03/color-survey-results/>color survey</a>, the site shows you a color shade and presents two color choices for that shade. For example, it shows you a <span style=color:#00878e>dark turquoise</span> and asks you if it&rsquo;s <span style=color:#32cd32>Green</span> or <span style=color:#547cff>Blue</span>. Then it shows you what other people thought it was.</p><a class=img-link target=_blank href=/img/turquoise-result.png><figure><img style=max-width:70% src=/img/turquoise-result.png alt=turquoise-result.png></figure></a><p>This the first thing I&rsquo;ve put out there that I wanted lots of random people to use and enjoy. I learned a lot from building it, some of which is discussed below.</p><h2 id=dont-design-in-htmlcss>don&rsquo;t design in html/css</h2><p>Unless you&rsquo;re <a href=https://lynnandtonic.com/>Lynn Fisher</a>, it can be pretty difficult to translate designs from your head immediately into code. This is obvious to any designer or artistic person, but these things I am not.</p><a class=img-link target=_blank href=/img/figma-cc-mobile.png><figure><img style=max-width:70% src=/img/figma-cc-mobile.png alt=figma-cc-mobile.png><figcaption class=figcaption-text>Note the original skull logo</figcaption></figure></a><p>Turns out clicking and dragging is a lot easier than CSS when in ideation. The mocks were mostly done before I wrote a line of code. I was able to get feedback from friends on a real-looking site without any serious up-front investment.</p><h2 id=sign-up-isnt-just-for-data-collection>sign up isn&rsquo;t just for data collection</h2><p>The things that take my breath away on the internet almost always load and immerse quickly. A <a href=https://paveldogreat.github.io/WebGL-Fluid-Simulation/>fluid simulation</a> or a <a href=https://www.pixelthoughts.co/>peaceful meditation</a> - no sign up flow, no pop ups or ads, no cookie consent required, nothing between you and the experience.</p><p>Notably, the examples above deliver the entire content to the users&rsquo; browser up front, then no further interaction with the internet is required.</p><p>Color Controversy does not behave this way. It collects repeated user input and persists it in a far-away server. So what if someone wants to spam the site with repeated requests from an automated script? What if someone wants to DDoS the site just for the LuLz?</p><p>A h4ck3r would have nothing to gain from doing this, but I felt I should operate in the &ldquo;whatever users can do, they will do&rdquo; mindset. I could have embedded a unique token in the browser that the user would automatically include in their data submission when operating the site as intended, but how to obtain the token in a way some script couldn&rsquo;t reproduce fairly easily?</p><p>When it comes down to it, deterrence for malicious action is limited without user-specific identification, i.e. sign up and login. Turns out there&rsquo;s more to sign up than just pernicious data collection for profit!</p><p>Sign up and login were a deal breaker for me user-experience wise, so what I settled for was implementing server-side <a href=https://github.com/robinovitch61/color-controversy/blob/master/backups/backup.sh>periodic backups of the database</a> with the knowledge that I could at least restore the data to a valid state if someone did decide to mess with it. Luckily, this hasn&rsquo;t been necessary so far.</p><h2 id=done-is-better-than-perfect>done is better than perfect</h2><p>Could I have worked harder to figure out how to get the play-swagger plugin to parse my Enum color values so I wouldn&rsquo;t have to replicate them manually on the frontend? Yes.</p><p>Is the color label text sometimes a little cut off on color labels on the results chart when the color is medium-controversial? Yes.</p><p>Are two different docker-compose files, one for dev and one for prod, the best way to do something resembling dev ops? Could I have pushed my built images to remote storage to avoid rebuilding them locally every time? Could I have figured out how to get my Scala Play container to compile and run on less RAM and saved a few dollars a month on AWS costs? Yes, yes, and yes.</p><p>But it&rsquo;s done! It works! People use it, and no one has submitted angry github issues denigrating my intelligence. In fact, I got my <a href=https://github.com/robinovitch61/color-controversy>first 3 github stars</a> on the project! I love it as is and am ready to move on.</p><h2 id=design-data-collection-early>design data collection early</h2><p>I did something really smart and/or really dumb in designing the data model for Color Controversy.</p><p>I decided that the database would never grow past its <a href=https://github.com/robinovitch61/color-controversy/blob/master/postgres/init.sql>original number of rows</a> - color submissions simply trigger a SQL query that mutates one of the values in the row of that color:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:green;font-weight:700>UPDATE</span><span style=color:#bbb> </span>color<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:green;font-weight:700>SET</span><span style=color:#bbb>    </span>n_first<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>CASE</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>WHEN</span><span style=color:#bbb> </span>(color.hex<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#ba2121>&#39;${hexColor}&#39;</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>AND</span><span style=color:#bbb> </span>color.first_option<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#ba2121>&#39;${choice}&#39;</span>)<span style=color:#bbb> </span><span style=color:green;font-weight:700>THEN</span><span style=color:#bbb> </span>n_first<span style=color:#bbb> </span><span style=color:#666>+</span><span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>ELSE</span><span style=color:#bbb> </span>n_first<span style=color:#bbb> </span><span style=color:green;font-weight:700>END</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>     </span>,<span style=color:#bbb> </span>n_second<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>CASE</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>WHEN</span><span style=color:#bbb> </span>(color.hex<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#ba2121>&#39;${hexColor}&#39;</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>AND</span><span style=color:#bbb> </span>color.second_option<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#ba2121>&#39;${choice}&#39;</span>)<span style=color:#bbb> </span><span style=color:green;font-weight:700>THEN</span><span style=color:#bbb> </span>n_second<span style=color:#bbb> </span><span style=color:#666>+</span><span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb> </span><span style=color:green;font-weight:700>ELSE</span><span style=color:#bbb> </span>n_second<span style=color:#bbb> </span><span style=color:green;font-weight:700>END</span><span style=color:#bbb>
</span></span></span></code></pre></td></tr></table></div></div><p>I know Postgres will handle this atomically and liked the idea of a database that was basically the same size no matter how large the traffic grew. No indexing or normalization required when you only have ~100 rows of data 😎.</p><p>Unfortunately, someone online pointed out soon after launch that it would have made for some interesting data to collect a little more than just color judgements. Browser usage, mobile/tablet/desktop, general location and time of day along with judgement made makes for some interesting data analysis after the fact.</p><p>Fortunately, completely by accident, I can pretty much parse all this out of the Nginx logs, which I started backing up periodically soon after I realized my mistake. They are sitting around ready for me to sift through at some future time.</p><p>Unfortunately, now I&rsquo;m sort of treating logs like a read-only database, and I maybe could have just designed this in to my Postgres schema in the first place without taking much of a performance hit. You win some, you lose some.</p><h2 id=put-your-stuff-out-there>put your stuff out there</h2><p>The internet is cool and building dumb stuff is fun. Making for the web is also kind of terrifying, because it&rsquo;s probably going to be around for a long time. Once you unleash it, it&rsquo;s out there, ready for judgement and criticism. Write my name on it and people&rsquo;s negative reaction to it could be thinly veiled negative reactions to <span class=word-break>MeAndMyStupidDumbBrainWhyWouldIEvenTryToMakeAThingAnywayGahhhhhhh</span>.</p><p>I remember eagerly refreshing my first reddit submission for the site and it being downvoted to 0.</p><p>Then someone with a million twitter followers tweets it and getting 200k color judgements in a day.</p><p>Then I read harsh criticism of it on a french speaking early 2000&rsquo;s-looking forum.</p><p>Then a niche Italian art blog emails me asking for permission to write about it for an article.</p><p>Then I watch as no one engages with it at all for 10 sequential hours.</p><p>Then John Austin, whose <a href="https://www.youtube.com/watch?v=AS1OHMW873s">color theory talk</a> I reference in the <code>What?</code> section of the site, tells me the site reached him before I could tweet at him about it.</p><p>Wild ride, I&rsquo;ll tell ya!</p><h2 id=in-colorclusion>in colorclusion</h2><p>It was fun and worth it and I&rsquo;ll do it all again with something new! I may make a follow-up post at some point in the future once I parse through all the logs and make something pretty with them.</p></article><article><h2>covid projects</h2><p>I have been very fortunate to remain employed during this global pandemic. My productivity working from home has been about on par with what I had in the office, although my learning rate has gone down a bit due to the lack of water-cooler style chats about the product and software in general. We use Slack for remote chat and it feels a bit too formal to trigger notifications for offhand questions.</p><p>My free time has been sometimes well-spent, sometimes less so. One of the efforts I&rsquo;m proud of is <a href=https://covid19medstudents.ca/>covid19medstudents.ca</a>. In the spirit <a href=https://theleo.zone/posts/gifting-websites/>gifting websites</a> and leveraging tech to help the COVID relief effort in some way, I collaborated with a good friend from home to make this site. My friend is president of his medical student&rsquo;s society, and along with a talented designer on his team (<a href=http://www.nancyduanart.com/>Nancy Duan</a>, <a href="https://www.instagram.com/nancyduanart/?hl=en">@nancyduanart</a>), we created an online index of volunteer opportunities and resources aimed at medical students and physicians in Western Canada. It has connected physicians and med students to ~50 projects across 3 provinces over the last couple months.</p><a class=img-link target=_blank href=/img/covid19medstudentshome.png><figure><img style=max-width:95% src=/img/covid19medstudentshome.png alt=covid19medstudentshome.png><figcaption class=figcaption-text>The landing page is very pretty IMO</figcaption></figure></a><p>It was a satisfying effort. I was feeling quite useless during the early stages of the pandemic, being neither essential nor truly negatively effected. I enjoyed working with a friendly client to fulfill a vision, working with a skilled designer to make things look great, and hearing about volunteers getting connected to projects through the site.</p><p>I&rsquo;ve also had the chance to be a Section Leader for Stanford&rsquo;s online &ldquo;Code In Place&rdquo; class. The instructors of CS106A, a relatively well-known intro to programming course offered by Stanford, decided to run a remote &ldquo;first half of the course&rdquo; over 6 weeks of instruction during COVID. Over 5 of those weeks, I met up with ~8 students via zoom as a teaching assistant and we worked through Python challenges together. Participants were brand new to programming and from a huge variety of backgrounds. Seeing them grow and progress over the 5 weeks from learning what a variable was to writing their own text parsers was so very cool.</p><p>Another fun project has been taking on the semi-famous <a href=https://cryptopals.com/>cryptopals cryptography challenges</a>. Many sharp folks at the <a href=https://www.recurse.com/>Recurse Center</a> were working on these during my time there and I had heard it was a good way to learn a new programming language. I&rsquo;m <a href=https://github.com/robinovitch61/cryptopals/tree/master/src>solving them in Scala</a> as that&rsquo;s the primary language used at my work, and I&rsquo;ve also taken the opportunity to encorporate a test driven development approach to the challenges. My tests vary in quality, from <code>"frequencyScore" should "be smaller for more englishey things"</code> to <code>"encodeToHexWithXorVigenere" should "encode correctly"</code>.</p><p>I&rsquo;ve absolutely loved the format of the challenges - clear and seemingly &ldquo;simple enough&rdquo; questions with very little theoretical explanations, leaving the solver to do the digging and self-education required to make sense of things. For instance, in set 1, question 6, they walk you through a method of finding first the key length, then the key itself for a ciphertext encoded using a repeated-key XOR cipher. Things they don&rsquo;t tell you outright:</p><ul><li>Given a collection of characters, estimating a probability that the characters were sampled from English or from random garbage text is both a science and an art. They recommend frequency scoring, and my final <code>frequencyScore</code> function included character frequency comparisons to the English language as well as checks for <code>allCharsInAsciiRange</code> and <code>hasReasonableNumSpecialChars</code>. I also experimented with number of spaces in the text sample, to less than excellent results. It felt like getting a good model for this was half the challenge.</li><li>The challenge talks about computing and maybe averaging the hamming distance of ciphertext snippets to get the key length. The hamming distance is the number of differing bits. Three equal-length strings, A, B, and K, have the same number of bits. The XOR operation is 1 only if the bits are different, so you can get the hamming distance by counting the number of ones after XOR&rsquo;ing two strings. Note that <code>num_1_bits(A XOR K XOR B XOR K) = num_1_bits(A XOR B)</code>. Also, since English has non-uniform character frequency, the hamming distance of two english snippets is lower than that of two garbage snippets, as english is more similar to english than random text is to random text. All of this was very non-obvious to me and required reading and experimenting a decent amount! Averaging the hamming distance was also definitely necessary to get good results across other encoded text with different keys.</li><li>Cracking repeating-key XOR is relatively probabilistic. The longer the ciphertext in relation to the key, the better shot at decoding you&rsquo;ve got! It was easy for me to spend too much time optimizing for instantly cracking all future possible key/text combos - I had to say enough was enough and move on at some point.</li></ul><p>Here is some code I cracked:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>0b3637272a2b2e63622c2e69692a23693a2a3c6324202d623d63343c2a26226324272765272a282b2f20430a652e2c652a3124333a653e2b2027630c692b20283165286326302e27282f
</span></span></code></pre></td></tr></table></div></div><p>is hex-encoded ciphertext for repeating key XOR of:</p><blockquote><p>Burning &rsquo;em, if you ain&rsquo;t quick and nimble\nI go crazy when I hear a
cymbal</p></blockquote><p>encoded with</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ICE
</span></span></code></pre></td></tr></table></div></div><p>😁</p><p>I&rsquo;ve also been playing a good amount of Zelda: Breath of the Wild, Rocket
League, and Super Smash Bros. Finally, I&rsquo;m now a plant Dad.</p><a class=img-link target=_blank href=/img/plontz.JPG><figure><img style=max-width:95% src=/img/plontz.JPG alt=plontz.JPG><figcaption class=figcaption-text>Proud of my lil' guys!</figcaption></figure></a></article><article><h2>gifting websites</h2><p>Over the past year or so, I have gifted friends a few websites. I think the sites are fun, relatively unique gifts. As a bonus serve, they illustrate some of my progression with basic html/css/javascript static websites.</p><h2 id=site-1-averyrobinscomhttpswwwaveryrobinscom>Site 1: <a href=https://www.averyrobins.com>averyrobins.com</a></h2><a class=img-link target=_blank href=/img/averyrobins.png><figure><img style=max-width:100% src=/img/averyrobins.png alt=averyrobins.png></figure></a><p>I set up an Amazon S3 bucket for static hosting, bought a namecheap domain name, configured the custom DNS, and voila - I now pay $1/month to host this profanity-laden ASCII art. 90% of the time went to setting up, hosting and routing the content - I spent about 20mins on the actual index.html file.</p><p>When my content first appeared when I typed <a href=https://averyrobins.com>averyrobins.com</a></a> in to my browser, I was so stoked. I was suddenly a contributor to the previously untouchable monolith of public knowledge, beauty and idiocy that is the internet.</p><p>Avery was a fan! Much as I felt when this site went live, it&rsquo;s generally pretty cool to have a public URI that points out your existence. Anyone can see it anywhere from any connected device. For me, this also brings a healthy level of discomfort.</p><h2 id=site-2-lettikittelcomhttpslettikittelcom>Site 2: <a href=https://lettikittel.com>lettikittel.com</a></h2><a class=img-link target=_blank href=/img/lettikittel.png><figure><img style=max-width:100% src=/img/lettikittel.png alt=lettikittel.png></figure></a><p>A similar gift exchange with the same group of friends rolled around this year, this time for Valentine&rsquo;s Day - a &ldquo;sexy&rdquo; gift exchange. I decided to step up my website gifting game with some basic interactivity. What&rsquo;s a sexier gift than a static website with some basic javascript?</p><p>Since the days of averyrobins.com, I had taken a few courses on <a href=https://scrimba.com/>scrimba.com</a> and learned how to style up a mostly-responsive site by building this one you&rsquo;re on now. My site is currently hosted through <a href=https://pages.github.com/>Github Pages</a> connected to a namecheap domain. I realized I could save the $1/month AWS fee (and a bunch of setup time) by creating a github account for Letti and doing the same thing there for her site.</p><p>Since the setup was so quick, I was actually able to focus on the styling and content of the site a lot more. It was fun to mess around with something that ended up pretty much looking like a customized MySpace page.</p><h2 id=site-3-katerinejimenezcomhttpskaterinejimenezcom>Site 3: <a href=https://katerinejimenez.com>katerinejimenez.com</a></h2><a class=img-link target=_blank href=/img/katjimenez.png><figure><img style=max-width:100% src=/img/katjimenez.png alt=katjimenez.png></figure></a><p>Kat was hosting her blog on wix.com, and without paying the annual fee, the wixsite.com subdomain was displayed in the URI. How could anyone take the content seriously with such a subdomain!? It was absolutely necessary for me to invest hours into porting the content to an entirely new platform.</p><p>I made Kat buy the domain name on namecheap and gave her a list of Jekyll themes. She picked one she liked and I emulated the layout and style, again hosting it on Github Pages. I think it looks quite nice.</p><p>In conclusion, websites can make a great gift for any occasion. These little projects taught me a lot about how the web works&ndash;I started from quite an unknowledgeable place&ndash;and I enjoyed making them a lot!</p></article><article><h2>givewell is awesome</h2><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script type=text/javascript id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><p><em>Note: this is my personal commentary and this post is not officially endorsed by Givewell in any way.</em></p><p><a href=https://www.givewell.org/>Givewell</a> is one of the most admirable philanthropic organizations out there. They recognize and act upon a number of important truths:</p><ul><li>Money is a super powerful tool for reducing harm in the world</li><li>Money can be used in more and less effective ways</li><li>The effectiveness of money can be modeled with finite (possibly wide) uncertainty bounds at a non-trivial confidence level</li><li>Encouraging those with the means to donate money to effective causes is important and worthwhile</li><li>Moral judgement is an inseparable part of judging the effectiveness of an outcome</li></ul><p>Not only does Givewell maintain an active <a href=https://blog.givewell.org/>blog</a>, a <a href=https://www.givewell.org/giving101>Giving 101</a> section of its site, run free events in the Bay Area every few months and deliver well-curated <a href=https://www.givewell.org/formstack/email-signup>email updates</a>, but they keep updated copies of their <a href=https://www.givewell.org/how-we-work/our-criteria/cost-effectiveness/cost-effectiveness-models>Cost Effectiveness Models</a> and <a href=https://docs.google.com/document/d/1ZKq-MNU-xtn_48uN33L6VvBEZRAduvjwWMeaEffL4K4/edit>Guide to Cost Effective Analysis</a> available online for everyone to view. Transparency is <a href=https://www.givewell.org/how-we-work/transparency>explicitly a core value of the organization</a>.</p><p>After digging through some of this available content in detail, I&rsquo;d like to lay out a few key points and assumptions as clear a manner as possible.</p><p>First, they talk about the relationship between income ($$$) and consumption (value of used goods and services). It is difficult to infer one from the other - for example, a household&rsquo;s crop production may contribute to consumption (if they consume the crops), income (if they sell the crops), or both.</p><p>Givewell states:</p><blockquote><p>When modeling interventions that we expect will alter people&rsquo;s productivity or work success, we prefer to think in terms of consumption rather than income&mldr;Consumption measurements are in some sense &ldquo;the gold standard&rdquo; for measures of material well-being in development economics research. (<a href=https://docs.google.com/document/d/1ZKq-MNU-xtn_48uN33L6VvBEZRAduvjwWMeaEffL4K4/edit#>source</a>)</p></blockquote><p>Unfortunately, research often only measures income, as consumption is more difficult to reliably quantify. A reasonable approximation is to assume that consumption and income are equivalent:</p><a class=img-link target=_blank href=/img/income_consumption.png><figure><img style=max-width:80% src=/img/income_consumption.png alt=income_consumption.png></figure></a><p>From this point forward in my discussion and in all Givewell documentation, it is reasonable to think of income and consumption as equivalent unless otherwise stated. I will arbitrarily choose to use the term consumption to represent both.</p><p>When examining consumption in relation to well-being (well-being representing self-reported happiness, decrease in suffering, hope for the future, etc.), it&rsquo;s intuitively true that increasing consumption linearly would yield diminishing returns in well-being. At low levels of consumption, an extra \$10/day may result in a doubling or tripling of one&rsquo;s well being! At high levels of consumption, an extra \$10/day may feel almost like an insult if its meant to measurably increase ones well-being - the economic equivalent of <a href="https://www.youtube.com/watch?v=cW-wTkUBBeo">&ldquo;you want a cookie or something?&rdquo;</a>.</p><p>For each base on the plot below, it can be said that &ldquo;well-being increases an equivalent amount (one unit) each time consumption is multiplied by {the base}&rdquo;.</p><a class=img-link target=_blank href=/img/consumption_dim.png><figure><img style=max-width:80% src=/img/consumption_dim.png alt=consumption_dim.png></figure></a><p>Another idea: rather than a linear increase in consumption increasing well-being a proportional amount, a doubling in consumption increases well-being a proportional amount. So \$10/day to \$20/day increases well-being an equivalent amount as \$5,000/day to \$10,000/day. This is a logarithmic relationship, in this case base 2 for a doubling. In practice, Givewell uses base $e \approx 2.72$, which isn&rsquo;t much different.</p><a class=img-link target=_blank href=/img/log_consumption_lin.png><figure><img style=max-width:80% src=/img/log_consumption_lin.png alt=log_consumption_lin.png></figure></a><p>This is assumption is supported in <a href=http://users.nber.org/~jwolfers/papers/Satiation(AER).pdf>this paper</a> which provides the plot shown below. Givewell recognizes the uncertainty here:</p><blockquote><p>&ldquo;The actual relationship between well-being and wealth is hotly debated.&rdquo; (<a href=https://docs.google.com/document/d/1ZKq-MNU-xtn_48uN33L6VvBEZRAduvjwWMeaEffL4K4/edit#>source</a>)</p></blockquote><a class=img-link target=_blank href=/img/wellbeing_gdp.png><figure><img style=max-width:80% src=/img/wellbeing_gdp.png alt=wellbeing_gdp.png></figure></a><p>The above research shows one measure on the y-axis: the satisfaction ladder, a measure of self-reported happiness. Givewell extrapolates this research such that the y-axis can just represent well-being of any metric. This is reasonable as long as the assumption that a linear-logarithmic relationship exists between consumption and the metric serving as a proxy for well-being.</p><p>The constant slope of the linear-logarithmic between well-being and consumption is something useful. It represents the <em>increase in well-being per unit increase in $ln(consumption)$</em>.</p><p>Givewell asks &ldquo;what would be the increase in well-being per a doubling of consumption from $c_1$ to $2c_1$?&rdquo;. This doubling of consumption is chosen arbitrarily and doesn&rsquo;t have anything to do with the base of the model - logarithmic base remains $e$.</p><p>$$ Slope = \frac{x}{\ln{2c_1} - \ln{c_1}} $$
$$ = \frac{x}{\ln{\frac{2c_1}{c_1}}} $$
$$ = \frac{x}{\ln{2}} $$
$$ \approx 1.443x $$</p><p>What is $x$? Well, $x$ is the amount well-being increased when consumption doubled. This could be read off the satisfaction ladder plot above, but then the slope would be valid only for that particular well-being metric. Instead, Givewell defines $x$ as the <span class=italic>general value assigned to doubling consumption for one person for one year</span>.</p><p>With this definition, say self-reported happiness increases by 3 units every time consumption doubles. The value of increasing happiness by 6 units caused by a quadrupling of consumption would then be $2x$. Consumption doubled twice, leading to twice the general value of doubling it once.</p><p>Slope, a function of $x$, can now be used to calculate the increase in well-being $\Delta WB$. Say an intervention causes a consumption increase of 4 times for one person in one year:</p><p>$$ \Delta WB = slope*(\ln(4c_1) - \ln(c_1)) $$
$$ \Delta WB = \frac{1}{\ln{2}}x*(\ln\frac{4c_1}{c_1}) $$
$$ \Delta WB = \frac{\ln4}{\ln{2}}x $$
$$ \Delta WB = 2x $$</p><p>Recall that x is the general value assigned to doubling consumption for one year. Increasing consumption by 4 times for one person for one year results in a well-being increase of twice the value of only doubling consumption.</p><p>Keeping things general like this may seem arbitrary and overly confusing now, but the real value of this method comes in when moral judgement is brought in to play. Say one would like to compare the value of doubling consumption for an individual in one year to the value of saving a young childs life. If one judges that saving the child&rsquo;s life is 50 times as good as doubling consumption, then set the value of that outcome to 50$x$! After some math, outcomes can be compared to one another.</p><p>I&rsquo;d like to continue digging through Givewell&rsquo;s open sourced materials. Likely future additional writing/projects to come.</p></article><article><h2>concurrency in python</h2><a class=img-link target=_blank href=/img/concurrency.png><figure><img style=max-width:70% src=/img/concurrency.png alt=concurrency.png><figcaption class=figcaption-text>Concurrency ! easy is</figcaption></figure></a><p>Concurrency is of paramount importance in modern computing. It is a complex domain in itself, with major contributions from database development, machine learning, distributed application deployment, and academia.</p><p>Python requires a clear and simple concurrency framework as it is commonly used in high-compute settings like training neural networks. Matrix algebra has been made fast with NumPy and related tools, interfacing with C to get large performance improvements. In the machine learning context, Python often combines concurrency with this efficient toolset to yield readable, easily iterated-upon, and rapid results.</p><p>Modern computers already use concurrency for almost everything. It is likely that the machine you&rsquo;re reading this on has multiple cores/CPUs, each of which runs multiple processes (multiprocessing). Processes are just programs given a &ldquo;time chunk&rdquo; in which to run on a CPU, after which their state is cached efficiently while the next program runs. If a process is running and itself needs to do multiple things (e.g. show a loading icon while also actually loading the content), a process gets split in to threads, which themselves get allocated time chunks from the overall process&rsquo;s time chunk. Processes usually run separate from and possibly in parallel with other processes, with strictly defined ways of interacting with one another.</p><p>Underlying the original CPython interpreter is the Global Interpreter Lock (GIL). This ensures that the Python interpreter is controlled by only one thread at a time. This is mainly because Python cleans up memory by &ldquo;reference counting&rdquo; instead of other means like garbage collection, ownership, etc. If the reference count for an object drops to zero, Python releases the memory allocated for that object. But multiple threads could change the reference count for an object at the same time, possibly causing memory errors and weird bugs. The GIL is a single lock on the Python interpreter, ensuring that memory is properly managed and no <a href=https://en.wikipedia.org/wiki/Deadlock>deadlocks</a> occur. Because Python was designed decades ago and parallel processing wasn&rsquo;t as high priority, this solution to memory management assumption wasn&rsquo;t seen as a big deal back then.</p><p>Unfortunately, this means that multithreading for CPU-intensive tasks in Python doesn&rsquo;t actually expediate computation - you can write code that implies threads are helping to speed up a high CPU task, but the GIL will ensure that only one thread runs at a time anyway! In fact, multithreading on high CPU tasks will actually be SLOWER than a single thread, as the GIL has decently high overhead when locking/unlocking threads. The one place multithreading is advantageous is IO operations, as IO operations <a href=https://stackoverflow.com/questions/29270818/why-is-a-python-i-o-bound-task-not-blocked-by-the-gil>do not require the lock from the GIL</a>.</p><a class=img-link target=_blank href=/img/cpu_io_bound.png><figure><img style=max-width:70% src=/img/cpu_io_bound.png alt=cpu_io_bound.png><figcaption class=figcaption-text>Source: <a href=https://realpython.com/python-concurrency/>https://realpython.com/python-concurrency/</a></figcaption></figure></a><p>The degredation of performance with threaded compute and improvement in performance with threaded IO is demonstrated in the following static notebook:</p><script src=https://gist.github.com/robinovitch61/e9f94dabc8d46b269a279759676596a6.js></script><p>Race conditions occur when data is modified or dropped in an undesirable manner due to a process switching threads before read-modify-write code sections are complete! Here is a complete example of a race condition and how to fix it using locks:</p><script src=https://gist.github.com/robinovitch61/8bf045f09ab77e26527139b914fa55d9.js></script><p>Threading is all well and good, but what if we need true parallel operation on CPU bound computation to speed up a general task? That&rsquo;s where the <code>multiprocessing</code> built in package comes in. Processes have more overhead than threads, but get around the GIL-caused limitations of multithreading in CPython, allowing real compute performance improvements. Additionally, processes don&rsquo;t share global variables the same way threads do. Data sharing between processes is possible but explicitly specified in the code, making them generally safer. Threads are subject to race conditions and deadlocks, but these are more easily avoided with processes.</p><p>An example of how multiprocessing can speed up a CPU bound operation is as follows:</p><script src=https://gist.github.com/robinovitch61/380dc5af7c1bf684d5dbd64cac966f7c.js></script><p>I don&rsquo;t cover <code>asyncio</code> here, but that&rsquo;s a topic for another day! I hope <code>threading</code> and <code>multiprocessing</code> were made more clear from the above discussion and examples.</p><h2 id=references>References:</h2><ul><li><a href=https://lerner.co.il>Better Developers Mailing List of https://lerner.co.il/</a></li><li><a href=https://realpython.com/python-gil/>https://realpython.com/python-gil/</a></li><li><a href=https://medium.com/practo-engineering/threading-vs-multiprocessing-in-python-7b57f224eadb>https://medium.com/practo-engineering/threading-vs-multiprocessing-in-python-7b57f224eadb</a></li><li><a href=https://wiki.python.org/moin/GlobalInterpreterLock>https://wiki.python.org/moin/GlobalInterpreterLock</a></li><li><a href=https://medium.com/towards-artificial-intelligence/the-why-when-and-how-of-using-python-multi-threading-and-multi-processing-afd1b8a8ecca>https://medium.com/towards-artificial-intelligence/the-why-when-and-how-of-using-python-multi-threading-and-multi-processing-afd1b8a8ecca</a></li><li><a href=https://www.geeksforgeeks.org/multithreading-in-python-set-2-synchronization/>https://www.geeksforgeeks.org/multithreading-in-python-set-2-synchronization/</a></li><li><a href=https://realpython.com/python-concurrency/>https://realpython.com/python-concurrency/</a></li><li><a href=https://realpython.com/intro-to-python-threading/#race-conditions>https://realpython.com/intro-to-python-threading/#race-conditions</a></li></ul></article><article><h2>statistical bias</h2><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script type=text/javascript id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script>
<a class=img-link target=_blank href=/img/jigsaw.png><figure><img style=max-width:70% src=/img/jigsaw.png alt=jigsaw.png><figcaption class=figcaption-text>Eat my spheres!</figcaption></figure></a><p>You find yourself trapped in a room with Jigsaw, the villain from the Saw movies. There is a wood box of 100 spheres, some of them steel ball bearings and some of them gumballs. Jigsaw tells you that you can leave the room alive if you guess the number of steel ball bearings in the jar correctly. You can pull 10 random spheres out the 100 in the box as many times as you want, but each time you do, you have to eat all of them (yum!). Jigsaw will then replace the stuff you pulled out of the box with new ones - if you pulled 7 ball bearings and 3 gumballs, 7 and 3 are replaced respectively. You&rsquo;re like &ldquo;cool, I got this, I&rsquo;m just going to do this a bunch of times and average the number of ball bearings I have to eat each time, then multiply the average by 10 and go home to my family of 12&rdquo;. Little did you know, Jigsaw has implanted magnets in your fingertips, attracting the ball bearings. Your estimate will be biased no matter how many spheres you eat. You will be killed, and your family will mourn.</p><p>Bias, both in common vernacular and in statistics, can be thought of as the difference between the average estimate of some truth and the truth itself. Your cousin is biased because his opinions on the evils of gun control, while varied, are on average far from the truth. A statistical model is biased because the average difference between its fitted and true values are non-zero.</p><p>Say you estimate a model parameter, e.g. $ \hat{\beta} $, based off a sample of data. Assuming the data comes from some underlying distribution with true parameter $ \beta $, your estimate $ \hat{\beta} $ is unbiased if the average estimate of it is equal to the true parameter, i.e. $ E[\hat{\beta}] = \beta $.</p><p>The concept of bias-variance tradeoff is fundamental in modeling. Intuitively, bias is the average difference in model prediction to true value, as discussed above. Variance is how much the model changes when you alter the sample data.</p><a class=img-link target=_blank href=/img/high_and_low_bias.png><figure><img style=max-width:95% src=/img/high_and_low_bias.png alt=high_and_low_bias.png><figcaption class=figcaption-text>High and low model bias</figcaption></figure></a><p>Say, theoretically, that your goal is to have a good model. You might say &ldquo;I want my model&rsquo;s predictions to be close to reality&rdquo;. Even, &ldquo;I want the average squared-error of my models predictions to be minimized!&rdquo;. That&rsquo;s not a bad idea! But wait - the image on the left above looks great for that, right? Why is that not the best model? Because the points that this model is going through don&rsquo;t represent all the possible points - it&rsquo;s just a data sample. If you got some more data, your model might not perform very well - its mean-squared error (MSE) might go up.</p><p>Demonstrated visually, 3 models fit the data below. They increase in number of predictors, i.e. flexibility of the model. Note how there is always some model error (dashed line on right) - this is the irreducible error, due to things like randomness in the generation of future data and inability to parameterize the universe. The red line represents our test error, our test set being some data we withheld from the model while estimating its parameters. The grey line represents the training error, based on the data we estimated our model parameters with. Training error CAN go to zero, as in the left image above, but we really care about our test error. Test error represents our model&rsquo;s ability to make accurate future predictions.</p><a class=img-link target=_blank href=/img/bias_variance.png><figure><img style=max-width:95% src=/img/bias_variance.png alt=bias_variance.png><figcaption class=figcaption-text>The bias-variance tradeoff</figcaption></figure></a><p>Note that MSE can be mathematically decomposed in to bias and variance terms. Assume for some data sample/training set, it came from same &ldquo;data generating function&rdquo; $y = f(x) + \epsilon $ where $ \epsilon \sim N(0, \sigma^2) $. We want to find the $ \hat{f}(x) $ that results in predictions for $ y $ that minimize MSE for data even outside our sample.</p><p>$$ E[(y - \hat{f}(x))^2] = MSE $$
$$ = Bias[\hat{f}(x)]^2 + Var(\hat{f}(x)) + \sigma^2 $$</p><p>Proofs for this exist <a href=https://towardsdatascience.com/mse-and-bias-variance-decomposition-77449dd2ff55>here</a> and <a href=https://www.inf.ed.ac.uk/teaching/courses/mlsc/Notes/Lecture4/BiasVariance.pdf>here</a>.</p><p>The bias-variance tradeoff has an important consequence: it is possible that an increase in bias can actually decrease variance to the point where overall MSE is better! A good model minimizes MSE, not just bias or variance.</p><p>A concrete example of biased estimators exists below. Generating many samples from an underlying function, both MLE and OLS methods result in unbiased estimates of weights:</p><a class=img-link target=_blank href=/img/unbiased_weights.png><figure><img style=max-width:95% src=/img/unbiased_weights.png alt=unbiased_weights.png><figcaption class=figcaption-text>The mean estimate for each weight is the same as the red true value</figcaption></figure></a><p>Importantly, the MLE estimate for error variance $ \sigma^2 $ is biased, whereas the OLS estimate is unbiased. Note that the only difference between the MLE and OLS estimates is dividing by $ m - n $, the number of samples minus the number of predictors. Some intuition for how sample variance is biased without this division can be built from <a href=https://proofwiki.org/wiki/Bias_of_Sample_Variance>this proof</a>, while a more involved proof of the unbiased OLS error variance formula <a href=https://stats.stackexchange.com/questions/20227/why-is-rss-distributed-chi-square-times-n-p>lies here</a>.</p><a class=img-link target=_blank href=/img/biased_mle_error_var.png><figure><img style=max-width:95% src=/img/biased_mle_error_var.png alt=biased_mle_error_var.png><figcaption class=figcaption-text>MLE (left) mean estimate differs from the true value</figcaption></figure></a><p>Complete code for the simulation can be found in <a href=/ols_vs_mle_bias.html>the static notebook here</a>.</p><p>I hope this helped develop a deeper understanding of statistical bias. If you have any additions or errors to correct, please open an issue on the source of this website <a href=https://github.com/robinovitch61/the-leo-zone/issues>here</a>.</p><h2 id=references>References:</h2><ul><li><a href=https://towardsdatascience.com/understanding-the-bias-variance-tradeoff-165e6942b229>https://towardsdatascience.com/understanding-the-bias-variance-tradeoff-165e6942b229</a></li><li><a href=http://faculty.marshall.usc.edu/gareth-james/ISL/>http://faculty.marshall.usc.edu/gareth-james/ISL/</a></li><li><a href="https://www.youtube.com/watch?v=C3nIFH649wY">https://www.youtube.com/watch?v=C3nIFH649wY</a></li><li><a href=https://stats.stackexchange.com/questions/207760/when-is-a-biased-estimator-preferable-to-unbiased-one>https://stats.stackexchange.com/questions/207760/when-is-a-biased-estimator-preferable-to-unbiased-one</a></li><li><a href=https://en.wikipedia.org/wiki/Bias%E2%80%93variance_tradeof>https://en.wikipedia.org/wiki/Bias–variance_tradeof</a></li><li><a href=https://proofwiki.org/wiki/Bias_of_Sample_Variance>https://proofwiki.org/wiki/Bias_of_Sample_Variance</a></li><li><a href=https://www.inf.ed.ac.uk/teaching/courses/mlsc/Notes/Lecture4/BiasVariance.pdf>https://www.inf.ed.ac.uk/teaching/courses/mlsc/Notes/Lecture4/BiasVariance.pdf</a></li><li><a href=https://towardsdatascience.com/mse-and-bias-variance-decomposition-77449dd2ff55>https://towardsdatascience.com/mse-and-bias-variance-decomposition-77449dd2ff55</a></li></ul></article><article><h2>linear regression</h2><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script type=text/javascript id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><p><em>Update 2019-10-25: Added MLE derivation and OLS $ \sigma^2 $</em></p><p>I have learned linear regression a number of times with varying of levels of detail. I&rsquo;m making this document mostly as a reference for myself and any others who may be interested in the technique.</p><p>The concepts and explanations here come either from <a href=http://faculty.marshall.usc.edu/gareth-james/ISL/>An Introduction to Statistical Learning (ISLR)</a> or <a href=https://web.stanford.edu/~hastie/ElemStatLearn/>The Elements of Statistical Learning (ESLR)</a>. Other sources are listed at the bottom.</p><a class=img-link target=_blank href=/img/linreg.png><figure><img style=max-width:95% src=/img/linreg.png alt=linreg.png><figcaption class=figcaption-text>Good ol' linear regression</figcaption><figcaption class=figcaption-text>Source: <a href=https://en.wikipedia.org/wiki/Linear_regression>https://en.wikipedia.org/wiki/Linear_regression</a></figcaption></figure></a><p>Note that I will put most everything in multiple linear regression matrix format as it extends to any number of predictors, including the $ y = mx+b $ (i.e. $ y = \beta_1x_1 + \beta_0x_0 $) classic simple linear regression.</p><h2 id=notation-and-terminology>Notation and Terminology</h2><ul><li>$\mathbf{m}$: number of observations in data set<br>($\mathbf{m}$ denoted by $\mathbf{N}$ in ESLR and $\mathbf{n}$ in ISLR)</li><li>$\mathbf{n}$: number of predictors in data set<br>($\mathbf{n}$ denoted by $\mathbf{p}$ in both ISLR and ESLR)</li><li><em>Predictors</em> (also known as features, independent variables, inputs, or explanatory variables): $ x_0 $, $ x_1 $, $ x_2 $&mldr;$ x_{n-1} $ (where $ x_0 = 1 $)</li><li><em>Weights</em> (also known as parameters, multipliers, or regression coefficients): $ \beta_0 $, $ \beta_1 $, $ \beta_2 $&mldr;$ \beta_{n-1} $</li><li><em>Response</em> (also known as dependent variable): $ y_0, y_1, y_2, &mldr; y_{m-1} $, the actual data values associated with each set of $\mathbf{n}$ predictors</li><li><em>Fitted Values</em> (also known as outputs): $\hat{y}_0$, $\hat{y}_1$, $\hat{y}_2$, $\hat{y}_{m-1}$, the predictions of the response given some estimated weights $ \hat{\beta}_0, \hat{\beta}_1, \hat{\beta}_2, &mldr; \hat{\beta}_{n-1} $</li></ul><h2 id=what-does-linear-mean>What does <em>linear</em> mean?</h2><p>All that <em>linear</em> means is that the model is of the following form:</p><p>$$f(\mathbf{X}) = \mathbf{X}\beta$$</p><p>Here, matrix $\bf{X} \in \mathbb{R}^{m \times n}$, weight vector $\beta \in \mathbb{R}^{n \times 1}$ and the leftmost column of $ \mathbf{X} $ denoted $ X_0 $ is a column of 1s to represent the intercept.</p><ul><li>Linear regression is often thought of as a &ldquo;straight line fit&rdquo; to a set of observations. It doesn&rsquo;t [necessarily result in a straight line or flat plane, though. Consider that &lt;span class=&ldquo;inline-math](necessarily result in a straight line or flat plane, though. Consider that &lt;span class=&ldquo;inline-math)
The &ldquo;true&rdquo; relationship or &ldquo;population regression line&rdquo; between $ Y \in \mathbb{R}^{m \times 1} $ (the response values associated with each row/observation of $ \mathbf{X} $) and $ \mathbf{X} $ is</li></ul><p>$$ Y = f(\mathbf{X}) + \epsilon = \mathbf{X}\beta + \epsilon $$</p><p>Epsilon ($ \epsilon $) here represents the error term, encompassing omitted and unmeasurable predictors, measurement error of included predictors, and the generic inability of our selected linear model to fit the true relationship.</p><h2 id=indicators-that-linear-regression-model-is-lacking>Indicators that Linear Regression Model is Lacking</h2><p>After coming up with a linear regression model, there are various required checks in order to validate that the model is acceptable as a description of the data. If any of the following are true, it is necessary to either improve the data, model or accept linear regression is insufficient as a modeling technique under the given conditions.</p><p><a class=img-link target=_blank href=/img/anscombe.png><figure><img style=max-width:95% src=/img/anscombe.png alt=anscombe.png></figure></a><a class=img-link target=_blank href=/img/anscombetable.png><figure><img style=max-width:95% src=/img/anscombetable.png alt=anscombetable.png><figcaption class=figcaption-text>The need for checking assumptions</figcaption><figcaption class=figcaption-text>Source: <a href=https://en.wikipedia.org/wiki/Anscombe%27s_quartet>https://en.wikipedia.org/wiki/Anscombe%27s_quartet</a></figcaption></figure></a></p><h3 id=non-linearity-of-the-response-predictor-relationships>Non-linearity of the response-predictor relationships</h3><a class=img-link target=_blank href=/img/residualvsfit.png><figure><img style=max-width:95% src=/img/residualvsfit.png alt=residualvsfit.png><figcaption class=figcaption-text>Left plot shows trend in residuals while right plot indicates better fit</figcaption></figure></a><p>There should be a linear relationship between the predictors and the response. This can be confirmed or denied by plotting the residuals $ e_i = y_i - \hat{y}_i $ versus the fitted values $ \hat{y}_i $. If the residuals look evenly dispersed about the horizontal access, the model is reasonable. Note that a poor residual plot may just be an indicator of poor predictor selection, e.g. non-linear predictors ($ x^2, \sqrt{x} $, etc.) should be fed in to the model.</p><h3 id=correlation-of-error-terms>Correlation of error terms</h3><a class=img-link target=_blank href=/img/correlatederrors.png><figure><img style=max-width:95% src=/img/correlatederrors.png alt=correlatederrors.png><figcaption class=figcaption-text>Correlated errors: adjacent errors tend to be of similar sign and magnitude</figcaption></figure></a><p>Given ordered data (e.g. time series), plot the residuals in order of time. If patterns arise, it is likely your data has correlated error terms. In time series data, this is also called <a href=https://en.wikipedia.org/wiki/Autocorrelation>autocorrelation</a>. This could occur, for example, if you duplicated your time series dataset - looking at error terms in order, each one would have perfect correlation with the next or previous value! You would get the same parameter fits but drastically different confidence bounds. Other real world examples include sampling biological metrics from the same family or the stock market doing well during certain time periods and poorly in others. At times adding predictors to the model can solve this problem. There are also techniques for removal of autocorrelation with transformation.</p><h3 id=non-constant-variance-of-error-terms>Non-constant variance of error terms</h3><p><a class=img-link target=_blank href=/img/heteroscedasticity.png><figure><img style=max-width:95% src=/img/heteroscedasticity.png alt=heteroscedasticity.png></figure></a><a class=img-link target=_blank href=/img/heteroscedasticity2.png><figure><img style=max-width:95% src=/img/heteroscedasticity2.png alt=heteroscedasticity2.png><figcaption class=figcaption-text>Heteroscedasticity can sometimes be removed by transforming the response</figcaption></figure></a></p><p>For linear regression&rsquo;s standard errors, confidence bounds, and hypothesis tests, it is assumed that data was generated from a population regression line where the true error $ \epsilon $ is normally distributed with mean 0 and constant variance $ \sigma^2 $, that is $ \epsilon \sim N(0, \sigma^2) $. In reality, it is often the case in that $ \sigma^2 $ varies with the magnitude of the predictors and/or response - this is called heteroscedasticity. Transformation of the response may help the situation. If you have an idea of the variance of error at each response, you can also use weighted least squares.</p><h3 id=data-contain-outliers>Data contain outliers</h3><a class=img-link target=_blank href=/img/outlier.png><figure><img style=max-width:95% src=/img/outlier.png alt=outlier.png><figcaption class=figcaption-text>Spot the outlier</figcaption></figure></a><p>Outlier points have abnormally high residuals. Methods exist for determining what &ldquo;abnormal&rdquo; means here, including examining the studentized residuals (dividing residuals by their estimated standard error). Outliers may not dramatically affect the weights of a model, but can affect the confidence bounds, hypothesis tests and $ R^2 $ value. Removing outliers is sometimes favorable, especially if they stem from something like measurement error. Before removal, it&rsquo;s important to be sure that outliers aren&rsquo;t actually important pieces of data implying that your model is missing predictors or is somehow otherwise deficient.</p><h3 id=data-contain-high-leverage-points>Data contain high-leverage points</h3><a class=img-link target=_blank href=/img/leverage.png><figure><img style=max-width:95% src=/img/leverage.png alt=leverage.png><figcaption class=figcaption-text>Leverage: not just for negotiation anymore</figcaption></figure></a><p>High leverage points have unusual predictor values, e.g. point 41 on the left plot above. Note that in multiple regression it can appear that high leverage points appear normal if you only examine each predictor value individually (middle graph above). Instead, calculate leverage using the diagonal of the &ldquo;projection matrix&rdquo; $ \mathbf{H} = \mathbf{X}(\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T $. Methods for determining what leverage magnitude is unusual enough to be suspect exist, including the <a href=http://www.lithoguru.com/scientist/statistics/Lecture21.pdf>Williams Graph</a> similar the rightmost plot above.</p><h3 id=collinearity>Collinearity</h3><a class=img-link target=_blank href=/img/collinearity.png><figure><img style=max-width:95% src=/img/collinearity.png alt=collinearity.png><figcaption class=figcaption-text>Age and limit are not collinear while rating and limit are highly collinear</figcaption></figure></a><p>Collinearity occurs when 2 or more predictors are highly related. This reduces the accuracy of the estimates of the weights, as it becomes hard to parse out which predictor is having an effect on the response. Detecting collinearity can be done by calculating the <a href=https://en.wikipedia.org/wiki/Variance_inflation_factor>Variance Inflation Factor</a>, and solved by either removing one of the collinear predictors or combining collinear predictors together.</p><h3 id=endogeneity>Endogeneity</h3><p>Endogeneity occurs when there is correlation between model predictor(s) and the true error term $ \epsilon $. Note that the error term here is NOT the estimated error term $ \hat{\epsilon} $ as a result of the fitted values $ \hat{Y} $, but the true error term in the population regression line $ Y = \mathbf{X}\beta + \epsilon $. An example I found explained it well was the burger regression <a href=https://stats.stackexchange.com/questions/263324/how-can-the-regression-error-term-ever-be-correlated-with-the-explanatory-variab>here</a>. Upon suspicion that a predictor is endogenous, a way to test for it is outlined <a href="https://www.youtube.com/watch?v=61I-8tDgwag">here</a>. Enogeneity is different than heteroscedasticity, as explained <a href=https://stats.stackexchange.com/questions/261329/ols-difference-between-exogeneity-and-homoscedasticity>here</a>.</p><h3 id=notes-on--r2--coefficient-of-determination>Notes on $ R^2 $ (coefficient of determination)</h3><a class=img-link target=_blank href=/img/rsquared.png><figure><img style=max-width:95% src=/img/rsquared.png alt=rsquared.png><figcaption class=figcaption-text>Increasing $ R^2 $ from left to right</figcaption></figure></a><p>$ R^2 $ does nothing except measure the proportion of variability in Y that can be explained using X. It can always be made closer to 1 by adding more features/variables into the linear model, which at a certain point likely results in a too-flexible (overfit) model that fails to minimize test error. Where $ R^2 $ can be useful is in confirming previously held beliefs about what you are modeling. For example, modeling something in physics that theoretically should be extremely linear, an $ R^2 $ much smaller than 1 indicates something may be off with the model or data. Conversely, a low $ R^2 $ would actually be expected when modeling a complex situation with high residual errors due to other factors.</p><h2 id=normal-equation-for-estimated-weights--hatbeta->Normal Equation for Estimated Weights $ \hat{\beta} $</h2><p>In the Ordinary Least Squares approach, RSS (Residual Sum of Squares) as a function of $ \hat{\beta} $ is the function to minimize:</p><a class=img-link target=_blank href=/img/residuals.png><figure><img style=max-width:95% src=/img/residuals.png alt=residuals.png><figcaption class=figcaption-text>Red lines are residuals $ e_i $. RSS is the sum of the square of all residuals</figcaption></figure></a><p>$$ RSS = \sum_{i=1}^{m}e_i^2 = \sum_{i=1}^{m}(y_i - \hat{y}<em>i)^2 = \sum</em>{i=1}^{m}(y_i - x_i^T\hat{\beta})^2$$
where $y_i$ is the response and $\hat{y}_i = x_i^T\hat{\beta}$ is the fitted value. This is assuming $x_i \in \mathbb{R}^{n \times 1}$ and $\hat{\beta} \in \mathbb{R}^{n \times 1}$ are column vectors and that the first value in each $ x_i $ is 1.</p><p>We can rewrite this in matrix form with $\bf{X} \in \mathbb{R}^{m \times n}$ and $y \in \mathbb{R}^{m \times 1}$ as
$$RSS(\hat{\beta})=(y - \mathbf{X}\hat{\beta})^T(y - \mathbf{X}\hat{\beta})$$</p><p>Each estimated weight vector $\hat{\beta}$ will give a different $RSS$ value. Since the premise of Ordinary Least Squares (OLS) is minimizing $RSS$, we can take the derivative of $RSS(\hat{\beta})$ and set it to zero to obtain the normal equations for the $\hat{\beta}$ that minimizes $RSS$. Note that we use $ (\mathbf{AB})^T = \mathbf{B}^T\mathbf{A}^T $ and the fact that matrices are distributive:
$$RSS(\hat{\beta})=(y^T - (\mathbf{X}\hat{\beta})^T)(y - \mathbf{X}\hat{\beta})$$
$$RSS(\hat{\beta})=(y^T - (\hat{\beta}^T\mathbf{X}^T))(y - \mathbf{X}\hat{\beta})$$
$$RSS(\hat{\beta})=y^Ty - y^T\mathbf{X}\hat{\beta} - (\hat{\beta}^T\mathbf{X}^T)y + \hat{\beta}^T\mathbf{X}^T\mathbf{X}\hat{\beta}$$</p><p>Taking the derivative with respect to the estimated weights:
$$ \frac{\partial}{\partial{\hat{\beta}}}RSS(\hat{\beta}) = $$
$$
\color{grey}{\frac{\partial}{\partial{\hat{\beta}}}y^Ty}
\color{black}{-}
\color{red}{\frac{\partial}{\partial{\hat{\beta}}}(y^T\mathbf{X}\hat{\beta} + (\hat{\beta}^T\mathbf{X}^T)y)}
\color{black}{+}
\color{green}{\frac{\partial}{\partial{\hat{\beta}}}\hat{\beta}^T\mathbf{X}^T\mathbf{X}\hat{\beta}}
$$</p><p>Now luckily, $\color{grey}{\frac{\partial}{\partial{\hat{\beta}}}y^Ty}=0$ as response $y$ is independent of $\hat{\beta}$. In addition, the red term isn&rsquo;t so bad. Because $RSS$ is scalar, each term is a scalar. And since scalars are symmetric, $a^T=a$. Again, we use $ (\mathbf{AB})^T = \mathbf{B}^T\mathbf{A}^T $.</p><p>So the following holds:
$$\color{red}{ \frac{\partial}{\partial{\hat{\beta}}} (y^T\mathbf{X}\hat{\beta} + (\hat{\beta}^T\mathbf{X}^T)y) }$$
$$\color{red}{ = \frac{\partial}{\partial{\hat{\beta}}} ((y^T\mathbf{X}\hat{\beta})^T + (\hat{\beta}^T\mathbf{X}^T)y) }$$
$$\color{red}{ = \frac{\partial}{\partial{\hat{\beta}}} ((\mathbf{X}\hat{\beta})^Ty + (\hat{\beta}^T\mathbf{X}^T)y) }$$
$$\color{red}{ = \frac{\partial}{\partial{\hat{\beta}}} ((\hat{\beta}^T\mathbf{X}^T)y + (\hat{\beta}^T\mathbf{X}^T)y) }$$
$$\color{red}{ = \frac{\partial}{\partial{\hat{\beta}}} 2\hat{\beta}^T\mathbf{X}^Ty }$$</p><p>We can take advantage of the &ldquo;A is not a function of x&rdquo; identity <a href=https://en.wikipedia.org/wiki/Matrix_calculus#Vector-by-vector_identities>here</a>, $ \frac{\partial{x^T\mathbf{A}}}{\partial{x}} = \mathbf{A} $. There is a great intuitive walkthrough of this identity <a href=https://eli.thegreenplace.net/2015/the-normal-equation-and-matrix-calculus/#id3>here</a> if interested.
$$\color{red} {2\frac{\partial\hat{\beta}^T\mathbf{X}^Ty}{\partial{\hat{\beta}}} = 2\mathbf{X}^Ty }$$</p><p>The green term uses another identity, &ldquo;A is not a function of x, A is symmetric&rdquo; <a href=https://en.wikipedia.org/wiki/Matrix_calculus#Scalar-by-vector_identities>here</a>, $ \frac{\partial{x^T\mathbf{A}x}}{\partial{x}} = 2\mathbf{A}x $. Note that this relies on the $ \mathbf{A} $ matrix being symmetric, but since $ \mathbf{X}^T\mathbf{X} $ is indeed symmetric, this holds. Again, there is a great intuitive walkthrough of this other identity <a href=https://eli.thegreenplace.net/2015/the-normal-equation-and-matrix-calculus/#id3>here</a> if interested as well.
$$ \color{green} {\frac{\partial\hat{\beta}^T\mathbf{X}^T\mathbf{X}\hat{\beta}}{\partial{\hat{\beta}}} = 2\mathbf{X}^T\mathbf{X}\hat{\beta} }$$</p><p>Finally, we plug in all terms and set to 0:
$$
\frac{\partial}{\partial{\hat{\beta}}}RSS(\hat{\beta}) =
\color{grey}{0}
\color{black}{-}
\color{red}{2\mathbf{X}^Ty}
\color{black}{+}
\color{green}{2\mathbf{X}^T\mathbf{X}\hat{\beta}}
\color{black}{\ = 0}
$$</p><p>Rearranging, we get:
$$
\color{red}{\mathbf{X}^Ty}
\color{black}{=}
\color{green}{\mathbf{X}^T\mathbf{X}\hat{\beta}}
$$</p><p>And if $ \mathbf{X}^T\mathbf{X} $ is nonsingular, i.e. it has an inverse, we can solve directly for $ \hat{\beta} $ using the following:
$$ \hat{\beta} = (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^Ty$$</p><p>This is called the normal equation. It is helpful when the inverse $ (\mathbf{X}^T\mathbf{X})^{-1}\ $ is not too computationally intensive.</p><h2 id=maximum-likelihood-estimate-formulation>Maximum Likelihood Estimate Formulation</h2><p>From <a href=https://en.wikipedia.org/wiki/Maximum_likelihood_estimation>wikipedia</a>: &ldquo;Maximum Likelihood Estimation is a method of estimating the parameters of a probability distribution by maximizing a likelihood function, so that under the assumed statistical model the observed data is most probable&rdquo;. Some probabilistic process generated some data - which process parameters would have made our dataset the most likely? Expressed as conditional probability distributions, for some data, which parameters maximize $ P(data | parameters) $?</p><p>As stated before, the population regression line is:</p><p>$$ Y = \mathbf{X}\beta + \epsilon $$</p><p>where $ \mathbf{X}\beta $ is constant. Gaussian linear regression assumes that $ \epsilon $ is normally distributed with mean 0 and variance $ \sigma^2 $, $ \epsilon \sim N(0, \sigma^2) $. Examining the distribution of $ Y$ under this assumption, noting that $E[X + Y] = E[X] + E[Y] $ regardless of independence:</p><p>$$ E[Y] = E[\mathbf{X}\beta + \epsilon] $$
$$ = E[\mathbf{X}\beta] + E[\epsilon] $$
$$ = E[\mathbf{X}\beta] + 0 $$
$$ = \mathbf{X}\beta $$</p><p>And for variance, since</p><p>$$ Var(X) = E[X^2] - (E[X])^2 $$</p><p>from <a href=https://en.wikipedia.org/wiki/Variance>here</a> and</p><p>$$ Cov(X,Y) = E[XY] - E[X]E[Y] $$</p><p>from <a href=https://en.wikipedia.org/wiki/Covariance>here</a>, then:</p><p>$$ Var(A + B) = E[(A + B)^2] - (E[A + B])^2 $$
$$ = E[A^2 + 2AB + B^2] - (E[A] + E[B])^2 $$
$$ = E[A^2] + E[2AB] + E[B^2] $$
$$ - E[A]^2 - 2E[A]E[B] - E[B]^2 $$
$$ = E[A^2] - E[A]^2 $$
$$ + E[B^2] - E[B]^2 $$
$$ + 2(E[AB] - E[A]E[B]) $$
$$ = Var(A) + Var(B) + 2Cov(A,B) $$</p><p>Substituting $A = \mathbf{X}\beta $, $B = \epsilon$ and recognizing Covariance as a measure of correlation between variables - positive if both tend to increase together, negative when one tends to increase while the other decreases - we can say:</p><p>$$ Var(\mathbf{X}\beta + \epsilon) = Var(\mathbf{X}\beta) + Var(\epsilon) + 2Cov(\mathbf{X}\beta, \epsilon) $$
$$ = 0 + \sigma^2 + 2Cov(\mathbf{X}\beta, \epsilon) $$</p><p>Due to the assumptions of linear regression outlined above (exogeneity and homoscedasticity), the correlation between $\mathbf{X}\beta$ and $\epsilon$ is zero. We conclude:</p><p>$$ Var(Y) = \sigma^2 $$</p><p>so:</p><p>$$ Y \sim N(\mathbf{X}\beta, \sigma^2) $$</p><p>With this in mind, we begin the actual MLE derivation. Given that the PDF of the gaussian distribution is:</p><p>$$ P(x|\mu_x, \sigma_x^2) = \frac{1}{\sigma_x\sqrt{2\pi}} \exp{\left\lbrace-\frac{1}{2\sigma_x^2}(x-\mu_x)\right\rbrace} $$</p><p>we can say the conditional probability of some datum $ y_i $ based on our parameters is:</p><p>$$ P(y_i|x_i, \beta, \sigma^2) = \frac{1}{\sigma\sqrt{2\pi}} \exp{\left\lbrace-\frac{1}{2\sigma^2}(y_i - x_i\beta)^2\right\rbrace} $$</p><p>where we somehow go through $ i = 0,1,2,&mldr;m $ data points and obtain the joint probability of all of them. Assuming our data are i.i.d. (independently and identically distributed, i.e. sampled from the same probability distribution and independent of one another) - we can say the joint probability of all the data is a product of individual probabilities:</p><p>$$ P(\{y_i\}_{i=0}^m | \{x_i\}_{i=0}^m, \beta, \sigma^2) = $$
$$ \prod_{i=0}^m{\frac{1}{\sigma\sqrt{2\pi}} \exp{\left\lbrace-\frac{1}{2\sigma^2}(y_i - x_i\beta)^2\right\rbrace}} $$</p><p>In matrix form:
$$ P(Y|X,\beta,\sigma^2) = $$
$$ \left(\frac{1}{\sigma\sqrt{2\pi}}\right)^m \exp{\left\lbrace-\frac{1}{2\sigma^2}(y-\mathbf{X}\beta)^T(y-\mathbf{X}\beta)\right\rbrace} $$</p><p>With MLE, we often take the log, as maximizing a summation is easier than maximizing a product due to ease of derivation. Note that the parameters that maximize some random variable X are the same that maximize log(X), so we&rsquo;re ok doing this.
$$ \ln(P(Y|X,\beta,\sigma^2)) = $$
$$ \color{red}{ m\ln\left(\frac{1}{\sigma\sqrt{2\pi}}\right) }
\color{black}{ - }
\color{green}{ \frac{1}{2\sigma^2}(y-\mathbf{X}\beta)^T(y-\mathbf{X}\beta) }
$$</p><p>Note that the red term doesn&rsquo;t have a $ \beta $ and is therefore irrelevant while we try to find the $ \beta $ that maximimizes $ \ln(P(Y|X,\beta,\sigma^2)) $. In order to do this, we must actually MINIMIZE the green term, as it&rsquo;s negative! So let&rsquo;s see&mldr;we want to minimize&mldr;
$$ \frac{1}{2\sigma^2}(y-\mathbf{X}\beta)^T(y-\mathbf{X}\beta) $$</p><p>Sound familiar? It&rsquo;s the same problem as the &ldquo;Normal Equation for Estimated Weights&rdquo; section before! This will again result in the normal equation:
$$ \beta^{MLE} = (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^Ty$$</p><p>Now note, we ignored the red term above to get the $ \beta^{MLE} $, but we can also maximize the joint probability distribution with respect to $ \sigma^2 $ in the MLE formulation. We derive and set to zero to find the maximum:
$$ \frac{\partial}{\partial{\sigma}}
\left( \color{red}{ m\ln\left(\frac{1}{\sigma\sqrt{2\pi}}\right) } \right)
\color{black}{ - \frac{\partial}{\partial{\sigma}} }
\left( \color{green}{ \frac{1}{2\sigma^2}(y-\mathbf{X}\beta)^T(y-\mathbf{X}\beta)) } \right)
$$
$$ = \color{red}{ -m (\sigma\sqrt{2\pi}) \left(\frac{1}{\sigma^2\sqrt{2\pi}}\right) }
\color{black}{ + }
\color{green}{ \frac{1}{\sigma^3}(y-\mathbf{X}\beta)^T(y-\mathbf{X}\beta)) }
$$
$$ = \color{red}{ -m }
\color{black}{ + }
\color{green}{ \frac{1}{\sigma^2}(y-\mathbf{X}\beta)^T(y-\mathbf{X}\beta)) }
\color{black}{ = 0 }
$$</p><p>Rerranging, we get the MLE estimate for the variance of $ \epsilon $:
$$ \sigma^{2MLE} = \frac{1}{m}(y-\mathbf{X}\beta)^T(y-\mathbf{X}\beta) $$</p><p>And note how this (satisfyingly) resembles the population variance formula for a normal distribution:
$$ \sigma^2_x = E[(x - \mu_x)^2] $$</p><h2 id=confidence-in-estimated-parameters>Confidence in Estimated Parameters</h2><p>(Insert justification for searching for unbiased sigma^2 and variance of beta in the first place here)</p><p>Unfortunately, the MLE variance is actually a biased estimate of the population variance, i.e. $ E[\sigma^{2MLE}] \neq \sigma^2 $! For a discussion around this and empirical proof, see <a href=https://theleo.zone/posts/statistical-bias/>here</a>.</p><a class=img-link target=_blank href=/img/biased_mle_error_var.png><figure><img style=max-width:95% src=/img/biased_mle_error_var.png alt=biased_mle_error_var.png><figcaption class=figcaption-text>MLE (left) mean estimate differs from the true value</figcaption></figure></a><p>The unbiased formula for estimated error variance comes from <a href=http://lukesonnet.com/teaching/inference/200d_standard_errors.pdf>here</a> and the rigorous proof <a href=https://stats.stackexchange.com/questions/20227/why-is-rss-distributed-chi-square-times-n-p>here</a>:
$$ \sigma^{2OLS} = \frac{1}{m-n} (y-\mathbf{X}\beta)^T (y-\mathbf{X}\beta) $$</p><p>(Variance of beta here)</p><p><em>To be included sometime in the future: standard errors, confidence bounds, hypothesis tests, numerical methods.</em></p><h2 id=references>References:</h2><ul><li><a href=https://eli.thegreenplace.net/2014/derivation-of-the-normal-equation-for-linear-regression/>https://eli.thegreenplace.net/2014/derivation-of-the-normal-equation-for-linear-regression/</a></li><li><a href=https://eli.thegreenplace.net/2015/the-normal-equation-and-matrix-calculus/#id3>https://eli.thegreenplace.net/2015/the-normal-equation-and-matrix-calculus/#id3</a></li><li><a href=https://math.stackexchange.com/questions/2753210/when-can-we-say-that-a-mathrm-t-b-b-mathrm-t-a>https://math.stackexchange.com/questions/2753210/when-can-we-say-that-a-mathrm-t-b-b-mathrm-t-a</a></li><li><a href=https://ayearofai.com/rohan-3-deriving-the-normal-equation-using-matrix-calculus-1a1b16f65dda>https://ayearofai.com/rohan-3-deriving-the-normal-equation-using-matrix-calculus-1a1b16f65dda</a></li><li><a href=https://en.wikipedia.org/wiki/Transpose#Properties>https://en.wikipedia.org/wiki/Transpose#Properties</a></li><li><a href=https://github.com/robinovitch61/coursera_MachineLearning_AndrewNg>https://github.com/robinovitch61/coursera_MachineLearning_AndrewNg</a></li><li><a href=https://www.cs.princeton.edu/courses/archive/fall18/cos324/files/mle-regression.pdf>https://www.cs.princeton.edu/courses/archive/fall18/cos324/files/mle-regression.pdf</a></li><li><a href=https://www.math.uwaterloo.ca/~hwolkowi/matrixcookbook.pdf>https://www.math.uwaterloo.ca/~hwolkowi/matrixcookbook.pdf</a></li><li><a href=http://3.droppdf.com/files/pjxkI/regression-analysis-by-example-5th-edition.pdf>http://3.droppdf.com/files/pjxkI/regression-analysis-by-example-5th-edition.pdf</a></li><li><a href=https://stats.stackexchange.com/questions/263324/%5Bhow-can-the-regression-error-term-ever-be-correlated-with-the-explanatory-variab%5D(how-can-the-regression-error-term-ever-be-correlated-with-the-explanatory-variab)>https://stats.stackexchange.com/questions/263324/[how-can-the-regression-error-term-ever-be-correlated-with-the-explanatory-variab](how-can-the-regression-error-term-ever-be-correlated-with-the-explanatory-variab)</a></li><li><a href=http://www.lithoguru.com/scientist/statistics/Lecture21.pdf>http://www.lithoguru.com/scientist/statistics/Lecture21.pdf</a></li><li><a href=https://stats.stackexchange.com/questions/349244/beginner-q-residual-sum-squared-rss-and-r2>https://stats.stackexchange.com/questions/349244/beginner-q-residual-sum-squared-rss-and-r2</a></li><li><a href=https://en.wikipedia.org/wiki/Maximum_likelihood_estimation>https://en.wikipedia.org/wiki/Maximum_likelihood_estimation</a></li><li><a href="https://www.youtube.com/watch?v=ulZW99jsMXY">https://www.youtube.com/watch?v=ulZW99jsMXY</a></li><li><a href=https://medium.com/@komotlogelwa/r-squared-and-life-3cb220d5a03f>https://medium.com/@komotlogelwa/r-squared-and-life-3cb220d5a03f</a></li><li><a href=https://www.usna.edu/Users/math/dphillip/sa421.s16/variance-of-a-sum.pdf>https://www.usna.edu/Users/math/dphillip/sa421.s16/variance-of-a-sum.pdf</a></li><li><a href=https://en.wikipedia.org/wiki/Variance>https://en.wikipedia.org/wiki/Variance</a></li><li><a href=https://en.wikipedia.org/wiki/Covariance>https://en.wikipedia.org/wiki/Covariance</a></li><li><a href=https://brilliant.org/wiki/linearity-of-expectation/>https://brilliant.org/wiki/linearity-of-expectation/</a></li><li><a href=http://lukesonnet.com/teaching/inference/200d_standard_errors.pdf>http://lukesonnet.com/teaching/inference/200d_standard_errors.pdf</a></li><li><a href=https://web.stanford.edu/~mrosenfe/soc_meth_proj3/matrix_OLS_NYU_notes.pdf>https://web.stanford.edu/~mrosenfe/soc_meth_proj3/matrix_OLS_NYU_notes.pdf</a></li></ul></article><article><h2>jupyter with docker</h2><p>I love <a href=https://www.docker.com>docker</a>. It makes environments:</p><ul><li>portable across any machine</li><li>subject to version control (retraceable and recoverable history)</li><li>easily deployed and discarded with simple commands</li></ul><p>Jupyter is a great tool that allows for the creation of nice looking documents consisting of ordered code chunks with inline output. It is a fantastic way to get started with programming, clearly step through your workflow, and/or create stories and presentations out of your work. It runs in the browser after you install it on your machine (i.e. you access it with a URL in your web browser).</p><a class=img-link target=_blank href=/img/jupyterlab_ex.png><figure><img style=max-width:95% src=/img/jupyterlab_ex.png alt=jupyterlab_ex.png><figcaption class=figcaption-text>Source: <a href=https://jupyterlab.readthedocs.io/en/stable/>https://jupyterlab.readthedocs.io/en/stable/</a></figcaption></figure></a><p>This walkthrough will get you set up with a jupyter lab (or jupyter notebooks classic) environment that is fully customizable, isolated, version controllable and portable using docker.</p><p>If you don&rsquo;t want to use docker, you can always <a href=https://jupyter.org/install>install jupyter the classic way</a>. I like docker for the reasons outlined above (isolation, portability, version controllable, easily deployed/discarded).</p><h2 id=1-install-docker>1: Install Docker</h2><p>To install Docker, you&rsquo;ll have to follow the instructions below:</p><ul><li><a href=https://docs.docker.com/docker-for-mac/install/>Install docker for Mac</a></li><li><a href=https://docs.docker.com/install/linux/docker-ce/ubuntu/>Install docker for Ubuntu</a></li><li><a href=https://docs.docker.com/docker-for-windows/install/>Install docker for Windows 10</a></li></ul><p>Once installed, you&rsquo;ll want to open a terminal (or cmd.exe for windows) and enter <code>docker</code>. You should see a long list of options and commands and not something like <code>command 'docker' not found</code>. If you see the long list, you&rsquo;re ready to proceed!</p><p>Docker uses the language of images (<em>recipes for containers</em>) and containers (<em>instances of images</em>). In this specific case, things like <code>jupyter/minimal-notebook</code> and <code>jupyter/pyspark-notebook</code> are <strong>images</strong> while our <strong>container</strong> will just be called <code>juptyer</code>.</p><p>I like to think of a container as an isolated environment that my app/service (in this case, jupyter) will run in, almost entirely isolated from the rest of my host machine.</p><a class=img-link target=_blank href=/img/docker-infrastructure.png><figure><img style=max-width:95% src=/img/docker-infrastructure.png alt=docker-infrastructure.png><figcaption class=figcaption-text>Source: <a href=https://www.docker.com/resources/what-container>https://www.docker.com/resources/what-container</a></figcaption></figure></a><h2 id=2-clone-the-docker-stacks-repo>2: Clone the <code>docker-stacks</code> Repo</h2><p>You&rsquo;ll need git for this step, which you can <a href=https://git-scm.com/book/en/v2/Getting-Started-Installing-Git>install here</a> if you don&rsquo;t already have it. You can check by typing <code>git</code> in to the terminal and seeing if the command is found.</p><p>What you&rsquo;ll clone is <a href=https://github.com/jupyter/docker-stacks>Project Jupyter&rsquo;s docker-stacks</a>. You can also <a href=https://help.github.com/en/articles/fork-a-repo>fork this</a> repo and clone your fork. We&rsquo;ll go through adding a couple files to this repo that will make deployment and customizing things easy. You can use <a href=https://github.com/robinovitch61/docker-stacks>my fork</a> or this tutorial as a reference. To clone the <code>docker-stacks</code> repo, run the following command in terminal/command prompt:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#408080;font-style:italic># run in the desired directory, e.g. ~/projects </span>
</span></span><span style=display:flex><span>git clone https://github.com/jupyter/docker-stacks.git
</span></span></code></pre></td></tr></table></div></div><p>The <code>docker-stacks</code> directory we just cloned contains a lot of stuff. Open the folder in your favorite editor or just look at the repo <a href=https://github.com/jupyter/docker-stacks>here</a>. We&rsquo;re going to look at just a few bits of a few important files. First, the <code>Dockerfile</code> in the <code>/base-notebook</code> directory:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#408080;font-style:italic>############################################</span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic>## docker-stacks/base-notebook/Dockerfile ##</span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic>############################################</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic># Copyright (c) Jupyter Development Team.</span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic># Distributed under the terms of the Modified BSD License.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic># Ubuntu 18.04 (bionic) from 2019-06-12</span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic># https://github.com/tianon/docker-brew-ubuntu-core/commit/3c462555392cb188830b7c91e29311b5fad90cfe</span>
</span></span><span style=display:flex><span>ARG <span style=color:#19177c>BASE_CONTAINER</span><span style=color:#666>=</span>ubuntu:bionic-20190612@sha256:9b1702dcfe32c873a770a32cfd306dd7fc1c4fd134adfb783db68defc8894b3c
</span></span><span style=display:flex><span>FROM <span style=color:#19177c>$BASE_CONTAINER</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>LABEL <span style=color:#19177c>maintainer</span><span style=color:#666>=</span><span style=color:#ba2121>&#34;Jupyter Project&#34;</span>
</span></span><span style=display:flex><span>ARG <span style=color:#19177c>NB_USER</span><span style=color:#666>=</span><span style=color:#ba2121>&#34;jovyan&#34;</span>
</span></span><span style=display:flex><span>ARG <span style=color:#19177c>NB_UID</span><span style=color:#666>=</span><span style=color:#ba2121>&#34;1000&#34;</span>
</span></span><span style=display:flex><span>ARG <span style=color:#19177c>NB_GID</span><span style=color:#666>=</span><span style=color:#ba2121>&#34;100&#34;</span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic># ...</span>
</span></span></code></pre></td></tr></table></div></div><p>This <code>Dockerfile</code> specifies that all jupyter containers will derive from a Linux Ubuntu &ldquo;bionic&rdquo; OS (<code>BASE_CONTAINER=ubuntu...</code>).</p><p>If you examine the <code>Dockerfile</code>s for other directories, you&rsquo;ll see there&rsquo;s a chain of derivations that end in the base-notebook:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#408080;font-style:italic># minimal-notebook/Dockerfile, top section:</span>
</span></span><span style=display:flex><span>ARG <span style=color:#19177c>BASE_CONTAINER</span><span style=color:#666>=</span>jupyter/base-notebook
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic># scipy-notebook/Dockerfile, top section:</span>
</span></span><span style=display:flex><span>ARG <span style=color:#19177c>BASE_CONTAINER</span><span style=color:#666>=</span>jupyter/minimal-notebook
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic># datascience-notebook/Dockerfile, top section:</span>
</span></span><span style=display:flex><span>ARG <span style=color:#19177c>BASE_CONTAINER</span><span style=color:#666>=</span>jupyter/scipy-notebook
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic># pyspark-notebook/Dockerfile, top section:</span>
</span></span><span style=display:flex><span>ARG <span style=color:#19177c>BASE_CONTAINER</span><span style=color:#666>=</span>jupyter/scipy-notebook
</span></span></code></pre></td></tr></table></div></div><p>The docker-stacks team has structured the project so you can specify how complicated of a setup you want out of the box based on what image you select. The <code>jupyter/minimal-notebook</code> image will contain the simplest installation you need for jupyter to run at all. The <code>jupyter/pyspark-notebook</code> image will come with a lot more, like a spark installation in the jupyter container file system (likely overkill unless you&rsquo;re using pyspark!). Higher up images in the inheritance tree will include everything below them (e.g. pyspark-notebook contains everything from scipy-notebook, minimal-notebook, and base-notebook).</p><h3 id=custom-file-1-docker-compose>Custom File 1: Docker Compose</h3><p>The first file we add to the <code>docker-stacks</code> base repo is <code>docker-compose.yml</code>. The <code>docker-compose</code> tool is often used for orchestrating many containers (e.g. &ldquo;bring up an nginx container and a jupyter container together so nginx can act as a reverse proxy and make the jupyter URL more user-friendly&rdquo;), but here we only have one container (<code>jupyter</code>). I like to use <code>docker-compose.yml</code> as a way of version controlling a <code>docker run</code> command, which is typically used to bring single containers up. All <code>docker-run</code> commands can be translated into <code>docker-compose</code> files and vice versa.</p><p>You&rsquo;ll create a <code>docker-stacks/docker-compose.yml</code> file that looks something like this (totally up to you to customize!):</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#408080;font-style:italic>############################################</span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic>## docker-stacks/docker-compose.yml ##</span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic>############################################</span>
</span></span><span style=display:flex><span>version: <span style=color:#ba2121>&#39;3&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>services:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    jupyter:
</span></span><span style=display:flex><span>    container_name: jupyter
</span></span><span style=display:flex><span>    image: jupyter/minimal-notebook <span style=color:#408080;font-style:italic># always get `latest` image on docker hub</span>
</span></span><span style=display:flex><span>    <span style=color:#408080;font-style:italic># image: jupyter/pyspark-notebook:1386e2046833 # tagged/pinned image example. check for updates here: https://hub.docker.com/r/jupyter/pyspark-notebook/tags.</span>
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>        - ~/:/home/jovyan/work/
</span></span><span style=display:flex><span>        - ./setup_envs.sh:/usr/local/bin/before-notebook.d/setup_envs.sh
</span></span><span style=display:flex><span>    ports:
</span></span><span style=display:flex><span>        - 9999:9999
</span></span><span style=display:flex><span>    restart: unless-stopped
</span></span><span style=display:flex><span>    environment:
</span></span><span style=display:flex><span>        JUPYTER_ENABLE_LAB: <span style=color:#ba2121>&#39;yes&#39;</span>
</span></span><span style=display:flex><span>    command: &gt;
</span></span><span style=display:flex><span>        sh -c <span style=color:#ba2121>&#34;bash start-notebook.sh\
</span></span></span><span style=display:flex><span><span style=color:#ba2121>                --NotebookApp.token=</span><span style=color:#19177c>$JUPYTER_PASSWORD</span><span style=color:#ba2121>\
</span></span></span><span style=display:flex><span><span style=color:#ba2121>                --NotebookApp.notebook_dir=/home/jovyan/work/\
</span></span></span><span style=display:flex><span><span style=color:#ba2121>                --port 9999&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>Meaning of this witchcraft:</p><ul><li><code>version '3'</code>: docker-compose specifies versions. They have slightly different syntax between them</li><li><code>services</code>: our list of services here is just one service called jupyter that will create a container called jupyter</li><li><code>image</code>: here is where you call out which image you want to use, as discussed above</li><li><code>volumes</code>: this is how you break isolation between the container and host environment, linking directories and/or files from the host to the container filesystems. This is important because otherwise when you destroy your container, your files would be lost with it. Syntax * <code>host_path:container_path</code>. Changes made in either host or container will reflect in the other</li><li><code>ports</code>: jupyter will run on a port in the container. <code>ports</code> binds the host port to the container port. Syntax is <code>host_port:container_port</code></li><li><code>restart: unless-stopped</code>: if your container fails, it will auto-restart unless you stop it with e.g* <code>docker-compose down</code></li><li><code>environment</code>: specify environment variables. <code>JUPYTER_ENABLE_LAB</code> enables jupyter lab by default</li><li><code>command</code>: this is the final command docker will run in the container upon build. <code>NotebookApp.token</code> password-protects your jupyter instance. The port here should also match the container port * <code>ports</code> above</li></ul><h3 id=custom-file-2-setup-script>Custom File 2: Setup Script</h3><p>You may have noticed that the second volume specified in the <code>docker-compose.yml</code> file is called <code>./setup_envs.sh</code>. This is a custom startup script that I use to do the following:</p><ul><li>Create environment variables that are accessible in jupyter</li><li>Add jupyterlab extensions</li><li>Create custom conda environments and link them to jupyter kernels</li><li>Run other useful commands in the container upon startup (e.g. configure git, install <code>vim</code> or <code>svn</code>, etc.)</li></ul><p>You&rsquo;ll create a <code>docker-stacks/setup_envs.sh</code> file that looks something like this (totally up to you to customize!):</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#408080;font-style:italic>############################################</span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic>## example docker-stacks/setup_envs.sh ##</span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic>############################################</span>
</span></span><span style=display:flex><span><span style=color:green>echo</span> <span style=color:#ba2121>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:green>echo</span> <span style=color:#ba2121>&#34;Creating useful environment variables...&#34;</span>
</span></span><span style=display:flex><span><span style=color:green>export</span> <span style=color:#19177c>MYVAR</span><span style=color:#666>=</span><span style=color:#19177c>$MYVAR</span>
</span></span><span style=display:flex><span><span style=color:green>export</span> <span style=color:#19177c>MYVAR2</span><span style=color:#666>=</span><span style=color:#19177c>$MYVAR2</span>
</span></span><span style=display:flex><span><span style=color:green>echo</span> <span style=color:#ba2121>&#34;Finished creating useful environment variables!&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green>echo</span> <span style=color:#ba2121>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:green>echo</span> <span style=color:#ba2121>&#34;Adding jupyterlab extensions...&#34;</span>
</span></span><span style=display:flex><span>rm -rf /home/jovyan/work/extensions
</span></span><span style=display:flex><span>mkdir /home/jovyan/work/extensions
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic># Great extension by calpoly for better markdown formatting in cells: https://github.com/jupytercalpoly/jupyterlab-richtext-mode</span>
</span></span><span style=display:flex><span>git clone https://github.com/jupytercalpoly/jupyterlab-richtext-mode.git /home/jovyan/work/extensions/jupyter-scribe <span style=color:#666>&amp;&amp;</span> <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span><span style=color:green>cd</span> /home/jovyan/work/extensions/jupyter-scribe <span style=color:#666>&amp;&amp;</span> <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>npm install <span style=color:#666>&amp;&amp;</span> <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>npm run build <span style=color:#666>&amp;&amp;</span> <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>jupyter labextension link .
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic># Rebuild to get extensions to work</span>
</span></span><span style=display:flex><span>jlpm build
</span></span><span style=display:flex><span>jupyter lab build
</span></span><span style=display:flex><span><span style=color:green>echo</span> <span style=color:#ba2121>&#34;Added jupyterlab extensions!&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green>echo</span> <span style=color:#ba2121>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:green>echo</span> <span style=color:#ba2121>&#34;Creating kernel py37...&#34;</span>
</span></span><span style=display:flex><span>conda create -n py37 <span style=color:#19177c>python</span><span style=color:#666>=</span>3.7.4 pip -y
</span></span><span style=display:flex><span><span style=color:green>echo</span> <span style=color:#ba2121>&#34;Finished creating kernel py37!&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#408080;font-style:italic># Install packages with pip, otherwise conda&#39;s &#34;auto-checking compatibility&#34; algo freaks out (with certain versions of conda)</span>
</span></span><span style=display:flex><span><span style=color:green>echo</span> <span style=color:#ba2121>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:green>echo</span> <span style=color:#ba2121>&#34;Installing packages in py37...&#34;</span>
</span></span><span style=display:flex><span><span style=color:green>source</span> activate py37 <span style=color:#666>&amp;&amp;</span> <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>pip install ipykernel <span style=color:#666>&amp;&amp;</span> <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>pip install pandas <span style=color:#666>&amp;&amp;</span> <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>pip install numpy <span style=color:#666>&amp;&amp;</span> <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>pip install scipy <span style=color:#666>&amp;&amp;</span> <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>pip install matplotlib <span style=color:#666>&amp;&amp;</span> <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span>pip install seaborn <span style=color:#666>&amp;&amp;</span> <span style=color:#b62;font-weight:700>\
</span></span></span><span style=display:flex><span><span style=color:#b62;font-weight:700></span><span style=color:green>echo</span> <span style=color:#ba2121>&#34;Finished installing packages in py37!&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:green>echo</span> <span style=color:#ba2121>&#34;&#34;</span>
</span></span><span style=display:flex><span><span style=color:green>echo</span> <span style=color:#ba2121>&#34;Connecting env to kernel...&#34;</span>
</span></span><span style=display:flex><span><span style=color:green>source</span> activate py37 <span style=color:#666>&amp;&amp;</span> python -m ipykernel install --user --name py37 --display-name <span style=color:#ba2121>&#34;py37&#34;</span>
</span></span><span style=display:flex><span><span style=color:green>source</span> activate py37 <span style=color:#408080;font-style:italic># must activate/deactivate once to have changes displayed</span>
</span></span><span style=display:flex><span><span style=color:green>source</span> activate base
</span></span><span style=display:flex><span><span style=color:green>echo</span> <span style=color:#ba2121>&#34;Connected env to kernel!&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cat &lt;&lt; <span style=color:#ba2121>&#34;EOF&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>WELCOME!
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>     ██╗██╗   ██╗██████╗ ██╗   ██╗████████╗███████╗██████╗
</span></span><span style=display:flex><span>     ██║██║   ██║██╔══██╗╚██╗ ██╔╝╚══██╔══╝██╔════╝██╔══██╗
</span></span><span style=display:flex><span>     ██║██║   ██║██████╔╝ ╚████╔╝    ██║   █████╗  ██████╔╝
</span></span><span style=display:flex><span>██   ██║██║   ██║██╔═══╝   ╚██╔╝     ██║   ██╔══╝  ██╔══██╗
</span></span><span style=display:flex><span>╚█████╔╝╚██████╔╝██║        ██║      ██║   ███████╗██║  ██║
</span></span><span style=display:flex><span> ╚════╝  ╚═════╝ ╚═╝        ╚═╝      ╚═╝   ╚══════╝╚═╝  ╚═╝
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Take it from here...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>EOF
</span></span></code></pre></td></tr></table></div></div><p><em>Dirty details on how this runs just by placing it in the container:</em> the <code>start-notebook.sh</code> script run by the <code>docker-compose</code> command will subsequently run <code>start.sh</code>. Both these shell scripts are in the <code>base-notebook</code> directory. The <code>start.sh</code> script has &ldquo;hooks&rdquo; for running scripts that are in the <code>/usr/local/bin/before-notebook.d</code>. <strong>All this to say that <code>setup_envs.sh</code> will be run as part of your jupyter setup</strong> because we put it in the <code>/usr/local/bin/before-notebook.d</code> directory in the jupyter container!</p><p>Note that you could totally exclude the <code>setup_envs.sh</code> script and volume and your deployment would be fully functioning. I like to use this method as a way of customizing my jupyter setup in a version-controlled manner. Rather than installing a new python package in my base environment or installing a system package every time manually and trying to remember what I did when I port to a new machine, I&rsquo;ll edit the <code>setup_envs.sh</code> script, commit and push to my fork, then redeploy on whatever machine I want and get the exact same setup.</p><h2 id=3-bring-up-the-jupyter-container>3: Bring Up the Jupyter Container</h2><p>If you&rsquo;ve gotten this far, you&rsquo;re basically done! The one thing we&rsquo;re missing is to set a password/token. In terminal, run this command with your custom password. If you don&rsquo;t do this, <code>docker-compose</code> will warn you at the next step.</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:green>export</span> <span style=color:#19177c>JUPYTER_PASSWORD</span><span style=color:#666>=</span><span style=color:#19177c>$MY_CUSTOM_PASSWORD</span>
</span></span></code></pre></td></tr></table></div></div><p>You can now navigate to the <code>docker-stacks</code> directory in a terminal and run:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose up -d
</span></span></code></pre></td></tr></table></div></div><p>The <code>-d</code> flag stands for &ldquo;detached&rdquo;, and ensures the <code>jupyter</code> container will stay running even if you exit the terminal.</p><p>You can now run:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker logs -f jupyter
</span></span></code></pre></td></tr></table></div></div><p>The <code>-f</code> flag standing for &ldquo;follow&rdquo;. Watch the progress in your terminal as your jupyter container is instantiated and your <code>setup_envs.sh</code> script is run (if you made one).</p><p>Once you see something like the following:</p><div class=highlight><div style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#666>[</span>I 16:19:04.574 LabApp<span style=color:#666>]</span> The Jupyter Notebook is running at:
</span></span><span style=display:flex><span><span style=color:#666>[</span>I 16:19:04.574 LabApp<span style=color:#666>]</span> http://3204808557f5:9999/?token<span style=color:#666>=</span>...
</span></span><span style=display:flex><span><span style=color:#666>[</span>I 16:19:04.575 LabApp<span style=color:#666>]</span>  or http://127.0.0.1:9999/?token<span style=color:#666>=</span>...
</span></span><span style=display:flex><span><span style=color:#666>[</span>I 16:19:04.575 LabApp<span style=color:#666>]</span> Use Control-C to stop this server and shut down all kernels <span style=color:#666>(</span>twice to skip confirmation<span style=color:#666>)</span>.
</span></span></code></pre></td></tr></table></div></div><p>You&rsquo;re ready to go! Navigate to <a href=http://127.0.0.1:9999>http://127.0.0.1:9999</a> (or whatever port you specified if different than <code>9999</code>) where you should see a page that prompts you for your password (set with the <code>JUPYTER_PASSWORD</code> environment variable earlier).</p><p>You have a fully functioning and replicable jupyter environment, portable to any machine that runs docker! Remember that even though your container has access to your host file system through the volume we created, your file system isn&rsquo;t (and shouldn&rsquo;t be) version controlled with the <code>docker-stacks</code> directory. Version control your projects separately.</p><h3 id=further-thoughts>Further thoughts</h3><ul><li>Another approach to version controlled customization could be to modify the Dockerfiles themselves. I prefer the <code>setup_envs.sh</code> script approach as rebuilding the images is time and disk space intensive. Modifying Dockerfiles, though, is a totally valid approach.</li><li>If you get stuck on anything in this process or see that I&rsquo;ve been wrong/unclear about something, please open an issue on the source of this website <a href=https://github.com/robinovitch61/the-leo-zone>here.</li></ul></article></div><footer><div class=container></div></footer></body></html>